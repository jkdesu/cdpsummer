<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Workflows</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  
  <!-- Chart-specific styles -->
  <style>
    /* Container styles */
    .timeline-container {
      margin: 2rem 0;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      max-width: 100%;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    /* Chart element styles */
    .artist-bar {
      cursor: pointer;
      transition: opacity 0.3s;
    }
    
    .artist-bar:hover {
      opacity: 0.8;
    }
    
    /* Tooltip styles */
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
    }
    
    /* Artwork modal styles */
    .artwork-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      text-align: center;
      position: relative;
    }
    
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    
    .modal-close:hover {
      color: #000;
    }
    
    .artwork-image {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      margin: 10px 0;
    }
    
    .artist-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .artwork-title {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    
    /* Legend styles */
    .category-legend {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    
    /* Link box hover effects */
    .workflow-link-box {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      min-width: 150px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .workflow-link-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: #007bff;
      background: #ffffff;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <span class="header-left">Ji-in Kang</span>
    <span class="header-right">Columbia University CDP 2025</span>
  </header>
  
  <!-- Navigation -->
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="colloquium1.html">Colloquium 1</a></li>
      <li><a href="modelling.html">Computational Modelling</a></li>
      <li><a href="mapping.html">Mapping Systems</a></li>
    </ul>
  </nav>
  
  <!-- Main content -->
  <main style="max-width: 1400px; margin: 0 auto; padding: 48px 32px 48px 32px;">
    <h2>Computational Design Workflows</h2>
    
    <!-- Workflow Tools Section -->
    <section>
      <h3>Design Workflow Tools</h3>
      <ul>
        <li><a href="#" onclick="showToolContent('p5js')">p5.js</a></li>
        <li><a href="#" onclick="showToolContent('threejs')">three.js</a></li>
        <li><a href="#" onclick="showToolContent('d3js')">d3.js</a></li>
        <li><a href="#" onclick="showToolContent('mapping')">mapbox</a></li>
        <li><a href="#" onclick="showToolContent('firebasepoll')">firebase: poll-app</a></li>
      </ul>
    </section>
    
    <!-- Tool Content Sections -->
    <div id="p5js-content" class="tool-content" style="display: none;">
      <h3>p5.js: Creative Coding</h3>
      
      <!-- First Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch1" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch2" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch3" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch4" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 4</p>
        </div>
      </div>
      
      <!-- Second Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch5" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 5</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch6" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 6</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch7" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 7</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch8" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 8</p>
        </div>
      </div>
      
      <!-- Third Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch9" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch10" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch11" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch12" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 4</p>
        </div>
      </div>
      
      <!-- Fourth Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch13" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch14" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch15" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch16" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 4</p>
        </div>
      </div>
      

    </div>
    
    <div id="threejs-content" class="tool-content" style="display: none;">
      <h3>Three.js: 3D Graphics</h3>
      
      <!-- Three.js Canvases Row -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="threejs-canvas1" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="threejs-canvas2" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="threejs-canvas3" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 3</p>
        </div>
      </div>
    </div>
    
    <div id="d3js-content" class="tool-content" style="display: none;">
      <h3>D3.js: Data Visualization</h3>
      
      <h4>Exploring Contemporary Artist</h4>
      
      <!-- Temporal Structure -->
      <div class="timeline-container">
        <h5>Temporal Structure</h5>
        <div id="timeline-chart"></div>
        <div class="category-legend" id="legend"></div>
      </div>
      
      <!-- Relational Structure -->
      <div class="timeline-container">
        <h5>Relational Structure</h5>
        <div id="relational-graph"></div>
      </div>
    </div>
    
    <div id="mapping-content" class="tool-content" style="display: none;">
      <h3>Exploring Mapping: Spatial Analysis</h3>
      
      <!-- Mapbox Map Container -->
      <div style="margin-top: 30px;">
        <div id="map" style="width: 100%; height: 500px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
        <div style="margin-top: 15px; text-align: center;">
          <div style="display: inline-flex; align-items: center; gap: 10px; background: white; padding: 10px 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <input type="text" id="neighborhood-search" placeholder="Search neighborhoods..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 250px;">
            <button id="search-btn" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Search</button>
          </div>
        </div>
        <p style="margin-top: 10px; font-size: 14px; color: #666; text-align: center;">Interactive Mapbox Map - New York City Area</p>
      </div>
      
      <!-- Subway Stations Map Container -->
      <div style="margin-top: 40px;">
        <div id="advanced-map" style="width: 100%; height: 600px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
        <div style="margin-top: 15px; text-align: center;">
          <button id="reset-view" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Reset View</button>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Manhattan Subway Stations Map</p>
          <p style="margin-top: 5px; font-size: 12px; color: #999;">Red dots = Subway stations • Hover for details • Click for more info</p>
        </div>
      </div>

      <!-- Third Map: Daily Routine -->
      <div style="margin-top: 60px;">
        <h2 style="color: #333; margin-bottom: 20px; text-align: center;">My Daily Routine</h2>
        
        <!-- Daily Routine Map Container -->
        <div style="margin-top: 30px;">
          <div id="routine-map" style="width: 100%; height: 500px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666; text-align: center;">Daily Routine: Home → Columbia → Study Session</p>
        </div>
      </div>
    </main>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  d3.csv("relational_fixed.csv").then(function(linksRaw) {
    const groupMap = {};
    const nodeMap = new Map();
  
    linksRaw.forEach(d => {
      const name = d.name.trim();
      const category = d.category.trim();
      let key = "";
  
      if (category === "education") {
        key = d.education.trim();
        nodeMap.set(key, { id: key, type: "education" });
      } else if (category === "nationality") {
        key = d.nationality.trim();
        nodeMap.set(key, { id: key, type: "nationality" });
      } else if (category === "gallery") {
        key = d.education.trim();
        nodeMap.set(key, { id: key, type: "gallery" });
      } else if (category === "exhibition_country") {
        key = d.nationality.trim();
        nodeMap.set(key, { id: key, type: "exhibition_country" });
      }
  
      if (!groupMap[key]) groupMap[key] = [];
      groupMap[key].push(name);
  
      // Ensure artist node is added
      if (!nodeMap.has(name)) {
        nodeMap.set(name, { id: name, type: "artist" });
      }
    });
  
    // ==================== BUILD LINKS ====================
    const links = [];
    Object.entries(groupMap).forEach(([key, members]) => {
      for (let i = 0; i < members.length; i++) {
        links.push({ source: members[i], target: key, type: nodeMap.get(key).type });
      }
    });
  
    const nodes = Array.from(nodeMap.values());
  
    // ==================== COLORS & RADIUS ====================
    const colorScale = {
      artist: "#1f77b4",
      education: "#2ca02c",
      gallery: "#ff7f0e",
      nationality: "#9467bd",
      exhibition_country: "#e377c2"
    };
  
    const radiusScale = {
      artist: 18,
      education: 14,
      gallery: 14,
      nationality: 14,
      exhibition_country: 14
    };
  
    // ==================== CANVAS ====================
    const width = 1200, height = 700;
    const svg = d3.select("#relational-graph")
      .html("")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .style("background", "#fafbfc")
      .style("border-radius", "10px");
  
    const zoomGroup = svg.append("g");
    svg.call(
      d3.zoom()
        .scaleExtent([0.5, 4])
        .on("zoom", event => zoomGroup.attr("transform", event.transform))
    );
  
    const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(100))
      .force("charge", d3.forceManyBody().strength(-300))
      .force("center", d3.forceCenter(width / 2, height / 2));
  
    // ==================== DRAW LINKS ====================
    const link = zoomGroup.append("g")
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", 1.5)
      .attr("stroke", d => colorScale[d.type] || "#ccc")
      .attr("stroke-opacity", 0.6);
  
    // ==================== DRAW NODES ====================
    const node = zoomGroup.append("g")
      .selectAll("g")
      .data(nodes)
      .join("g")
      .attr("class", "node")
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended)
      );
  
    node.append("circle")
      .attr("r", d => radiusScale[d.type] || 10)
      .attr("fill", d => colorScale[d.type] || "#ccc")
      .attr("stroke", "#333")
      .attr("stroke-width", 1.5);
  
    node.append("text")
      .attr("dy", 4)
      .attr("x", d => radiusScale[d.type] + 4)
      .style("font-size", "11px")
      .style("pointer-events", "none")
      .text(d => d.id);
  
    // ==================== TOOLTIP ====================
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("padding", "6px 10px")
      .style("background", "#fff")
      .style("border", "1px solid #ccc")
      .style("border-radius", "4px")
      .style("pointer-events", "none")
      .style("font-size", "12px");
  
    const labelMap = {
      artist: "Artist",
      education: "Education (School)",
      gallery: "Gallery",
      nationality: "Nationality",
      exhibition_country: "Exhibition Country"
    };
  
    node.on("mouseover", function(event, d) {
      tooltip.transition().duration(200).style("opacity", 1);
      tooltip.html(`<strong>${d.id}</strong><br><span style="color:#666">${labelMap[d.type] || "Unknown"}</span>`)
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 20) + "px");
  
      node.selectAll("circle").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
      node.selectAll("text").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
      link.transition().duration(200).style("opacity", l => l.source.id === d.id || l.target.id === d.id ? 1 : 0.05);
    }).on("mouseout", function() {
      tooltip.transition().duration(200).style("opacity", 0);
      node.selectAll("circle").transition().duration(200).style("opacity", 1);
      node.selectAll("text").transition().duration(200).style("opacity", 1);
      link.transition().duration(200).style("opacity", 0.6);
    });
  
    simulation.on("tick", () => {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);
  
      node.attr("transform", d => {
        d.x = Math.max(20, Math.min(width - 20, d.x));
        d.y = Math.max(20, Math.min(height - 20, d.y));
        return `translate(${d.x},${d.y})`;
      });
    });
  
    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }
    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }
    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }
  
    // ==================== LEGEND ====================
    const legendData = Object.entries(colorScale).map(([type, color]) => ({
      label: labelMap[type],
      color
    }));
  
    const legend = svg.append("g")
      .attr("transform", `translate(${width - 220}, 20)`);
  
    legend.selectAll("rect")
      .data(legendData)
      .join("rect")
      .attr("x", 0)
      .attr("y", (d, i) => i * 22)
      .attr("width", 14)
      .attr("height", 14)
      .attr("fill", d => d.color);
  
    legend.selectAll("text")
      .data(legendData)
      .join("text")
      .attr("x", 20)
      .attr("y", (d, i) => i * 22 + 11)
      .style("font-size", "13px")
      .style("fill", "#333")
      .text(d => d.label);
  });
  </script>  
  <!-- Artwork Modal -->
  <div class="artwork-modal" id="artworkModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeArtworkModal()">&times;</span>
      <div class="artist-name" id="modalArtistName"></div>
      <div class="artwork-title" id="modalArtworkTitle"></div>
      <img class="artwork-image" id="modalArtworkImage" src="" alt="Artwork">
    </div>
  </div>
  
  <!-- JavaScript for D3.js visualization -->
  <script>
    // ============================================================================
    // INITIALIZATION
    // ============================================================================
    
    document.addEventListener('DOMContentLoaded', function() {
      loadArtistTimeline();
    });
    
    // ============================================================================
    // ARTWORK DATA
    // ============================================================================
    
    const artworkData = {
      "Jean-Michel BASQUIAT": {
        title: "Untitled (Skull)",
        image: "./temporal/1. Skull.jpg"
      },
      "Yoshitomo NARA": {
        title: "In The White Room",
        image: "./temporal/2. In The White Room .jpg"
      },
      "Jeff KOONS": {
        title: "Balloon Dog",
        image: "./temporal/3. Balloon Dog.jpg"
      },
      "Keith HARING": {
        title: "Dancing Figures",
        image: "./temporal/4. Dancing.jpg"
      },
      "Damien HIRST": {
        title: "The Physical Impossibility of Death in the Mind of Someone Living",
        image: "./temporal/5. Damien Hirst.jpg"
      },
      "Takashi MURAKAMI": {
        title: "My Lonesome Cowboy",
        image: "./temporal/6. Takashi.jpg"
      },
      "Mister": {
        title: "Harajuku Kiss",
        image: "./temporal/7. Harajuku Kiss.jpg"
      },
      "MADSAKI": {
        title: "If I Had a Dream",
        image: "./temporal/8. if i had a dream.jpg"
      },
      "Richard PRINCE": {
        title: "Untitled (Cowboy)",
        image: "./temporal/9. cowboy.jpg"
      },
      "Jonas WOOD": {
        title: "Interior with Two Chairs",
        image: "./temporal/10. Jonas Wood.jpg"
      },
      "Iwamoto MASAKAZU": {
        title: "Contemporary Painting",
        image: "./temporal/11. Iwamoto.jpg"
      },
      "Tyler HOBBS": {
        title: "Generative Art Composition",
        image: "./temporal/12. Tyler Hobbes.avif"
      },
      "Lee UFAN": {
        title: "Mono-ha Installation",
        image: "./temporal/13. LEE.jpg"
      },
      "KAWS": {
        title: "Companion",
        image: "./temporal/14. kaws.jpeg"
      },
      "Tom SACHS": {
        title: "Nutsy's",
        image: "./temporal/15. Tom.webp"
      },
      "Daniel ARSHAM": {
        title: "Fictional Archeology",
        image: "./temporal/16. Daniel.webp"
      }
    };
    
    // ============================================================================
    // DATA LOADING
    // ============================================================================
    
    function loadArtistTimeline() {
      d3.csv('temporal.csv')
        .then(function(data) {
          console.log('Loaded artist data:', data);
          createTimelineVisualization(data);
        })
        .catch(function(error) {
          console.error('Error loading CSV:', error);
        });
    }
    
    // ============================================================================
    // CHART CREATION
    // ============================================================================
    
    function createTimelineVisualization(data) {
      // Chart dimensions and margins - increased for better fit
      const margin = {top: 40, right: 40, bottom: 80, left: 180};
      const width = 1200 - margin.left - margin.right;
      const height = 600 - margin.top - margin.bottom;
      
      // Clear existing content
      d3.select("#timeline-chart").html("");
      
      // Create SVG container
      const svg = d3.select("#timeline-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);
      
      // Create scales
      const scales = createScales(data, width, height);
      
      // Add chart elements
      addAxes(svg, scales, height);
      addTimelineBars(svg, data, scales);
      addChartLabels(svg, width, height);
      
      // Create legend
      createLegend(scales.categories, scales.colorScale);
    }
    
    // ============================================================================
    // SCALE CREATION
    // ============================================================================
    
    function createScales(data, width, height) {
      // Time scale (X-axis)
      const timeExtent = d3.extent(data, d => [+d.start, +d.end]).flat();
      const xScale = d3.scaleLinear()
        .domain([d3.min(timeExtent), d3.max(timeExtent)])
        .range([0, width]);
      
      // Artist names scale (Y-axis)
      const yScale = d3.scaleBand()
        .domain(data.map(d => d.name))
        .range([0, height])
        .padding(0.1);
      
      // Color scale for categories
      const categories = [...new Set(data.map(d => d.category))];
      const colorScale = d3.scaleOrdinal()
        .domain(categories)
        .range(d3.schemeCategory10);
      
      return { xScale, yScale, colorScale, categories };
    }
    
    // ============================================================================
    // CHART ELEMENTS
    // ============================================================================
    
    function addAxes(svg, scales, height) {
      // X-axis (timeline)
      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(scales.xScale).tickFormat(d3.format("d")).ticks(10))
        .selectAll("text")
        .style("text-anchor", "middle")
        .style("font-size", "12px");
      
            // Y-axis (artist names)
      svg.append("g")
        .call(d3.axisLeft(scales.yScale))
        .selectAll("text")
        .style("text-anchor", "end")      // Right-aligns the text
        .style("font-size", "12px")
        .attr("dx", "-0.8em")             // Pulls text closer to the axis line
        .attr("dy", "0.35em")             // Vertically aligns text better
        .style("cursor", "pointer")        // Shows pointer cursor
        .on("click", function(event, d) {
          showArtworkModal(d);
        });
    }
    
    function addTimelineBars(svg, data, scales) {
      svg.selectAll(".artist-bar")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "artist-bar")
        .attr("x", d => scales.xScale(+d.start))
        .attr("y", d => scales.yScale(d.name))
        .attr("width", d => scales.xScale(+d.end) - scales.xScale(+d.start))
        .attr("height", scales.yScale.bandwidth())
        .attr("fill", d => scales.colorScale(d.category))
        .attr("stroke", "#333")
        .attr("stroke-width", 1)
        .on("mouseover", function(event, d) {
          showTooltip(event, d);
        })
        .on("mouseout", function() {
          hideTooltip();
        });
    }
    
    function addChartLabels(svg, width, height) {
      // Chart title
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", -15)
        .attr("text-anchor", "middle")
        .style("font-size", "18px")
        .style("font-weight", "bold")
        .text("Artist Timeline Analysis (1968-2025)");
      
      // X-axis label
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height + 40)
        .attr("text-anchor", "middle")
        .style("font-size", "14px")
        .text("Year");
    }
    
    // ============================================================================
    // INTERACTIVITY
    // ============================================================================
    
    function showTooltip(event, data) {
      const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 10) + "px");
      
      tooltip.html(`
        <strong>${data.name}</strong><br/>
        Period: ${data.start} - ${data.end}<br/>
        Category: ${data.category}<br/>
        Duration: ${+data.end - +data.start} years
      `);
    }
    
    function hideTooltip() {
      d3.selectAll(".tooltip").remove();
    }
    
    // ============================================================================
    // LEGEND CREATION
    // ============================================================================
    
    function createLegend(categories, colorScale) {
      const legend = d3.select("#legend");
      legend.html("");
      
      categories.forEach(category => {
        const item = legend.append("div")
          .attr("class", "legend-item");
        
        item.append("div")
          .attr("class", "legend-color")
          .style("background-color", colorScale(category));
        
        item.append("span")
          .text(category);
      });
    }
    
    // ============================================================================
    // ARTWORK MODAL FUNCTIONS
    // ============================================================================
    
    function showArtworkModal(artistName) {
      const artwork = artworkData[artistName];
      if (artwork) {
        document.getElementById("modalArtistName").textContent = artistName;
        document.getElementById("modalArtworkTitle").textContent = artwork.title;
        document.getElementById("modalArtworkImage").src = artwork.image;
        document.getElementById("modalArtworkImage").alt = artwork.title;
        document.getElementById("artworkModal").style.display = "flex";
      }
    }
    
    function closeArtworkModal() {
      document.getElementById("artworkModal").style.display = "none";
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById("artworkModal");
      if (event.target === modal) {
        closeArtworkModal();
      }
    });
    
    // ============================================================================
    // TOOL CONTENT NAVIGATION
    // ============================================================================
    
    function showToolContent(toolName) {
      // Hide all tool content sections
      const allToolContent = document.querySelectorAll('.tool-content');
      allToolContent.forEach(content => {
        content.style.display = 'none';
      });
      
      // Show the selected tool content
      const selectedContent = document.getElementById(toolName + '-content');
      if (selectedContent) {
        selectedContent.style.display = 'block';
      }
    }   
    
    // ============================================================================
    // P5.JS SKETCHES
    // ============================================================================
    
    // Sketch 1
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch1');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 2
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch2');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 4
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch4');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 5
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch5');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 6
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch6');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 7
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch7');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 8
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch8');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 9 - 3D Animated Object 1
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 10;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch9');
        p.angleMode(p.DEGREES);
        
        // Create a separate 2D graphics buffer for the background
        pixelBackground = p.createGraphics(280, 280, p.P2D);
      };
      
      p.draw = function() {
        generatePixelBackground(); // regenerate every frame

        // Draw the pixelated background onto the main canvas
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // move back
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();
        
        // 3D object
        p.noFill();
        p.stroke(255);
        
        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;
        
        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);
        
        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200); 

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function generatePixelBackground() {
        for (let y = 0; y < pixelBackground.height; y += pixelSize) {
          for (let x = 0; x < pixelBackground.width; x += pixelSize) {
            let r = p.random(30, 80);
            let g = p.random(30, 80);
            let b = p.random(30, 80);
            pixelBackground.fill(r, g, b);
            pixelBackground.noStroke();
            pixelBackground.rect(x, y, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 10 - 3D Animated Object 2
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch10');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 11 - 3D Animated Object 3
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch11');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 12 - 3D Animated Object 4
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch12');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 13 - HSB 3D Layers 1
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch13');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 14 - HSB 3D Layers 2
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch14');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 15 - HSB 3D Layers 3
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch15');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 16 - HSB 3D Layers 4
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch16');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    

    
    // Sketch 3
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch3');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });

  </script>
  
  <!-- Three.js Library and Scenes -->
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js';
    
    // Three.js Scene 1
    let scene1, camera1, renderer1;
    let rings1 = [];
    let time1 = 0;

    function initThreeJS1() {
      const container = document.getElementById('threejs-canvas1');
      if (!container) return;

      scene1 = new THREE.Scene();
      camera1 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera1.position.z = 200;

      renderer1 = new THREE.WebGLRenderer({ antialias: true });
      renderer1.setSize(380, 380);
      container.appendChild(renderer1.domElement);

      // Pixelated Gradient Background Plane
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04; // smaller = finer

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            // subtle noise
            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false,
        transparent: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene1.add(bgMesh);

      // Add rings
      const ringCount = 5;
      for (let j = 0; j < ringCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const radius = 50 + j * 10;
          const geo = new THREE.TorusGeometry(radius, 1.5, 8, 64);
          const mat = new THREE.MeshBasicMaterial({ color: new THREE.Color(`hsl(${(i * 2 + j * 30) % 360}, 100%, 60%)`) });
          const mesh = new THREE.Mesh(geo, mat);
          mesh.rotation.y = THREE.MathUtils.degToRad(i);
          group.add(mesh);
        }

        group.position.z = -50 + j * 25;
        rings1.push(group);
        scene1.add(group);
      }

      animate1();
    }

    function animate1() {
      requestAnimationFrame(animate1);
      time1 += 1;

      // Update pixel background shader
      if (scene1 && scene1.children[0]) {
        scene1.children[0].material.uniforms.time.value = time1;
      }

      // Rotate rings & animate color
      rings1.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time1 * 0.5 + j * 30) % 360;
          mesh.material.color.setHSL(hue / 360, 1, 0.6);
        });
      });

      if (renderer1 && scene1 && camera1) {
        renderer1.render(scene1, camera1);
      }
    }



    // Three.js Scene 2
    let scene2, camera2, renderer2;
    let ellipseGroups2 = [];
    let time2 = 0;

    function initThreeJS2() {
      const container = document.getElementById('threejs-canvas2');
      if (!container) return;

      scene2 = new THREE.Scene();
      camera2 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera2.position.z = 200;

      renderer2 = new THREE.WebGLRenderer({ antialias: true });
      renderer2.setSize(380, 380);
      container.appendChild(renderer2.domElement);

      // Pixelated Gradient Background Shader
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene2.add(bgMesh);

      // Create ellipse rings
      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.CircleGeometry(1, 64); // Circle, will scale to ellipse
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.8, side: THREE.DoubleSide });
          const ellipse = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          // Position around a ring
          ellipse.position.x = Math.cos(angle) * radius;
          ellipse.position.y = Math.sin(angle) * radius;
          ellipse.position.z = -50 + j * 25;

          // Make it look like an ellipse by squishing the Y axis
          ellipse.scale.set(10, 5, 1);

          group.add(ellipse);
        }

        ellipseGroups2.push(group);
        scene2.add(group);
      }

      animate2();
    }

    function animate2() {
      requestAnimationFrame(animate2);
      time2 += 1;

      // Update pixel background
      if (scene2 && scene2.children[0]) {
        scene2.children[0].material.uniforms.time.value = time2;
      }

      // Animate ellipses
      ellipseGroups2.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time2 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer2 && scene2 && camera2) {
        renderer2.render(scene2, camera2);
      }
    }

    // Initialize when Three.js content is shown
    function initThreeJSContent() {
      const threeJSContent = document.getElementById('threejs-content');
      if (threeJSContent && threeJSContent.style.display !== 'none') {
        setTimeout(() => {
          initThreeJS1();
          initThreeJS2();
        }, 100);
      }
    }

    // Watch for content changes
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'threejs-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initThreeJS1();
              initThreeJS2();
              initThreeJS3();
            }, 100);
          }
        }
      });
    });

    // Three.js Scene 3
    let scene3, camera3, renderer3;
    let rectangleGroups3 = [];
    let time3 = 0;

    function initThreeJS3() {
      const container = document.getElementById('threejs-canvas3');
      if (!container) return;

      scene3 = new THREE.Scene();
      camera3 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera3.position.z = 200;

      renderer3 = new THREE.WebGLRenderer({ antialias: true });
      renderer3.setSize(380, 380);
      container.appendChild(renderer3.domElement);

      // Pixelated Background Shader
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene3.add(bgMesh);

      // Create rectangle rings
      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.PlaneGeometry(8, 20); // Flat rectangle
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.9 });
          const rect = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          // Position it in a circle
          rect.position.x = Math.cos(angle) * radius;
          rect.position.y = Math.sin(angle) * radius;
          rect.position.z = -50 + j * 25;

          // Make it face outward
          rect.lookAt(0, 0, rect.position.z);

          group.add(rect);
        }

        rectangleGroups3.push(group);
        scene3.add(group);
      }

      animate3();
    }

    function animate3() {
      requestAnimationFrame(animate3);
      time3 += 1;

      // Animate background
      if (scene3 && scene3.children[0]) {
        scene3.children[0].material.uniforms.time.value = time3;
      }

      // Animate rectangles
      rectangleGroups3.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time3 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer3 && scene3 && camera3) {
        renderer3.render(scene3, camera3);
      }
    }



    // Start observing
    if (document.getElementById('threejs-content')) {
      observer.observe(document.getElementById('threejs-content'), { attributes: true });
    }

    // ============================================================================
    // MAPBOX MAP
    // ============================================================================
    
    let map = null;

    function initMapbox() {
      const mapContainer = document.getElementById('map');
      if (!mapContainer) return;

      // Set your Mapbox access token
      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      // Initialize the map
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v12', // Outdoor style with terrain and natural features
        center: [-74.006, 40.7128], // New York City coordinates
        zoom: 12,
        pitch: 45, // Add some 3D tilt
        bearing: 0
      });

      // Add navigation controls
      map.addControl(new mapboxgl.NavigationControl(), 'top-right');

      // Add fullscreen control
      map.addControl(new mapboxgl.FullscreenControl(), 'top-right');

      // Add some custom markers when the map loads
      map.on('load', function() {
        // Add a custom marker for Columbia University
        const columbiaMarker = new mapboxgl.Marker({ color: '#007bff' })
          .setLngLat([-73.9626, 40.8075])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Columbia University</h3><p>Home of the Computational Design Program</p>'))
          .addTo(map);

        // Add a marker for Times Square
        const timesSquareMarker = new mapboxgl.Marker({ color: '#ff6b6b' })
          .setLngLat([-73.9855, 40.7580])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Times Square</h3><p>Iconic NYC landmark</p>'))
          .addTo(map);

        // Add a marker for Central Park
        const centralParkMarker = new mapboxgl.Marker({ color: '#28a745' })
          .setLngLat([-73.9654, 40.7829])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Central Park</h3><p>Urban green space</p>'))
          .addTo(map);
      });

      // Add click event to show coordinates
      map.on('click', function(e) {
        const coordinates = e.lngLat;
        new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML(`<h4>Coordinates</h4><p>Longitude: ${coordinates.lng.toFixed(4)}</p><p>Latitude: ${coordinates.lat.toFixed(4)}</p>`)
          .addTo(map);
      });

      // Neighborhood search data
      const neighborhoods = {
        'manhattan': { center: [-73.9654, 40.7829], zoom: 12, name: 'Manhattan' },
        'brooklyn': { center: [-73.9497, 40.6501], zoom: 11, name: 'Brooklyn' },
        'queens': { center: [-73.7949, 40.7282], zoom: 11, name: 'Queens' },
        'bronx': { center: [-73.8648, 40.8448], zoom: 11, name: 'The Bronx' },
        'staten island': { center: [-74.1502, 40.5795], zoom: 11, name: 'Staten Island' },
        'harlem': { center: [-73.9370, 40.8040], zoom: 14, name: 'Harlem' },
        'times square': { center: [-73.9857, 40.7580], zoom: 15, name: 'Times Square' },
        'central park': { center: [-73.9654, 40.7829], zoom: 14, name: 'Central Park' },
        'greenwich village': { center: [-73.9965, 40.7338], zoom: 15, name: 'Greenwich Village' },
        'soho': { center: [-73.9985, 40.7245], zoom: 15, name: 'SoHo' },
        'chelsea': { center: [-73.9960, 40.7370], zoom: 15, name: 'Chelsea' },
        'upper east side': { center: [-73.9580, 40.7680], zoom: 14, name: 'Upper East Side' },
        'upper west side': { center: [-73.9710, 40.7760], zoom: 14, name: 'Upper West Side' },
        'east village': { center: [-73.9840, 40.7260], zoom: 15, name: 'East Village' },
        'lower east side': { center: [-73.9900, 40.7160], zoom: 15, name: 'Lower East Side' },
        'financial district': { center: [-73.9850, 40.7070], zoom: 15, name: 'Financial District' },
        'battery park': { center: [-74.0150, 40.7020], zoom: 15, name: 'Battery Park' },
        'dumbo': { center: [-73.9870, 40.7030], zoom: 15, name: 'DUMBO' },
        'williamsburg': { center: [-73.9570, 40.7080], zoom: 14, name: 'Williamsburg' },
        'astoria': { center: [-73.9210, 40.7640], zoom: 14, name: 'Astoria' },
        'long island city': { center: [-73.9350, 40.7500], zoom: 14, name: 'Long Island City' },
        'flushing': { center: [-73.8200, 40.7500], zoom: 13, name: 'Flushing' },
        'jamaica': { center: [-73.8050, 40.7020], zoom: 13, name: 'Jamaica' },
        'forest hills': { center: [-73.8470, 40.7180], zoom: 14, name: 'Forest Hills' },
        'yankee stadium': { center: [-73.9260, 40.8290], zoom: 15, name: 'Yankee Stadium' },
        'coney island': { center: [-73.9810, 40.5750], zoom: 14, name: 'Coney Island' },
        'brighton beach': { center: [-73.9610, 40.5780], zoom: 14, name: 'Brighton Beach' },
        'bay ridge': { center: [-74.0270, 40.6150], zoom: 14, name: 'Bay Ridge' },
        'park slope': { center: [-73.9770, 40.6700], zoom: 14, name: 'Park Slope' },
        'prospect park': { center: [-73.9690, 40.6600], zoom: 14, name: 'Prospect Park' },
        'brooklyn heights': { center: [-73.9950, 40.7000], zoom: 15, name: 'Brooklyn Heights' },
        'red hook': { center: [-74.0090, 40.6750], zoom: 15, name: 'Red Hook' },
        'gowanus': { center: [-73.9900, 40.6730], zoom: 15, name: 'Gowanus' },
        'carroll gardens': { center: [-73.9950, 40.6800], zoom: 15, name: 'Carroll Gardens' },
        'cobble hill': { center: [-73.9950, 40.6860], zoom: 15, name: 'Cobble Hill' },
        'boerum hill': { center: [-73.9850, 40.6860], zoom: 15, name: 'Boerum Hill' },
        'fort greene': { center: [-73.9740, 40.6910], zoom: 15, name: 'Fort Greene' },
        'clinton hill': { center: [-73.9650, 40.6890], zoom: 15, name: 'Clinton Hill' },
        'bedford stuyvesant': { center: [-73.9420, 40.6830], zoom: 14, name: 'Bedford-Stuyvesant' },
        'bushwick': { center: [-73.9170, 40.6980], zoom: 14, name: 'Bushwick' },
        'ridgewood': { center: [-73.8970, 40.7000], zoom: 14, name: 'Ridgewood' },
        'glendale': { center: [-73.8800, 40.7020], zoom: 14, name: 'Glendale' },
        'middle village': { center: [-73.8770, 40.7180], zoom: 14, name: 'Middle Village' },
        'maspeth': { center: [-73.9050, 40.7230], zoom: 14, name: 'Maspeth' },
        'woodside': { center: [-73.9030, 40.7460], zoom: 14, name: 'Woodside' },
        'sunnyside': { center: [-73.9240, 40.7430], zoom: 14, name: 'Sunnyside' },
        'jackson heights': { center: [-73.8830, 40.7560], zoom: 14, name: 'Jackson Heights' },
        'elmhurst': { center: [-73.8800, 40.7440], zoom: 14, name: 'Elmhurst' },
        'corona': { center: [-73.8600, 40.7450], zoom: 14, name: 'Corona' },
        'rego park': { center: [-73.8600, 40.7260], zoom: 14, name: 'Rego Park' },
        'kew gardens': { center: [-73.8300, 40.7080], zoom: 14, name: 'Kew Gardens' },
        'briarwood': { center: [-73.8200, 40.7080], zoom: 14, name: 'Briarwood' },
        'jamaica hills': { center: [-73.8050, 40.7180], zoom: 14, name: 'Jamaica Hills' },
        'fresh meadows': { center: [-73.7900, 40.7380], zoom: 14, name: 'Fresh Meadows' },
        'bayside': { center: [-73.7700, 40.7580], zoom: 14, name: 'Bayside' },
        'douglaston': { center: [-73.7450, 40.7680], zoom: 14, name: 'Douglaston' },
        'little neck': { center: [-73.7400, 40.7750], zoom: 14, name: 'Little Neck' },
        'floral park': { center: [-73.7050, 40.7250], zoom: 14, name: 'Floral Park' },
        'new hyde park': { center: [-73.6850, 40.7350], zoom: 14, name: 'New Hyde Park' },
        'garden city': { center: [-73.6350, 40.7250], zoom: 14, name: 'Garden City' },
        'huntington': { center: [-73.4250, 40.8250], zoom: 12, name: 'Huntington' },
        'riverhead': { center: [-72.6620, 40.9170], zoom: 12, name: 'Riverhead' },
        'montauk': { center: [-71.9540, 41.0360], zoom: 13, name: 'Montauk' },
        'hamptons': { center: [-72.2070, 40.9540], zoom: 11, name: 'The Hamptons' },
        'fire island': { center: [-73.0620, 40.6500], zoom: 12, name: 'Fire Island' },
        'long beach': { center: [-73.6650, 40.5880], zoom: 13, name: 'Long Beach' },
        'jones beach': { center: [-73.5070, 40.5880], zoom: 13, name: 'Jones Beach' },
        'roosevelt island': { center: [-73.9490, 40.7620], zoom: 15, name: 'Roosevelt Island' },
        'governors island': { center: [-74.0160, 40.6890], zoom: 15, name: 'Governors Island' },
        'ellis island': { center: [-74.0400, 40.6990], zoom: 15, name: 'Ellis Island' },
        'liberty island': { center: [-74.0450, 40.6890], zoom: 15, name: 'Liberty Island' },
        'staten island ferry': { center: [-74.0470, 40.6410], zoom: 15, name: 'Staten Island Ferry' },
        'verrazzano bridge': { center: [-74.0470, 40.6060], zoom: 13, name: 'Verrazzano Bridge' },
        'brooklyn bridge': { center: [-73.9969, 40.7061], zoom: 15, name: 'Brooklyn Bridge' },
        'manhattan bridge': { center: [-73.9870, 40.7070], zoom: 15, name: 'Manhattan Bridge' },
        'williamsburg bridge': { center: [-73.9700, 40.7080], zoom: 15, name: 'Williamsburg Bridge' },
        'queensboro bridge': { center: [-73.9450, 40.7580], zoom: 15, name: 'Queensboro Bridge' },
        'robert f kennedy bridge': { center: [-73.9300, 40.7800], zoom: 14, name: 'Robert F. Kennedy Bridge' },
        'george washington bridge': { center: [-73.9530, 40.8510], zoom: 14, name: 'George Washington Bridge' },
        'holland tunnel': { center: [-74.0300, 40.7260], zoom: 15, name: 'Holland Tunnel' },
        'lincoln tunnel': { center: [-73.9900, 40.7580], zoom: 15, name: 'Lincoln Tunnel' },
        'queens midtown tunnel': { center: [-73.9450, 40.7580], zoom: 15, name: 'Queens Midtown Tunnel' },
        'brooklyn battery tunnel': { center: [-74.0150, 40.7020], zoom: 15, name: 'Brooklyn Battery Tunnel' }
      };

      // Add search functionality
      const searchInput = document.getElementById('neighborhood-search');
      const searchBtn = document.getElementById('search-btn');

      function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        
        if (searchTerm === '') {
          alert('Please enter a neighborhood name to search.');
          return;
        }

        // Find matching neighborhood
        const neighborhood = neighborhoods[searchTerm];
        
        if (neighborhood) {
          // Fly to the location
          map.flyTo({
            center: neighborhood.center,
            zoom: neighborhood.zoom,
            duration: 2000
          });

          // Show a popup with the neighborhood name
          new mapboxgl.Popup()
            .setLngLat(neighborhood.center)
            .setHTML(`<h3>${neighborhood.name}</h3><p>Welcome to ${neighborhood.name}!</p>`)
            .addTo(map);

          console.log(`Flying to ${neighborhood.name}`);
        } else {
          // Show suggestions for similar names
          const suggestions = Object.keys(neighborhoods).filter(name => 
            name.includes(searchTerm) || searchTerm.includes(name)
          ).slice(0, 5);

          if (suggestions.length > 0) {
            alert(`Neighborhood not found. Did you mean one of these?\n\n${suggestions.join('\n')}`);
          } else {
            alert('Neighborhood not found. Please try a different search term.');
          }
        }
      }

      // Add event listeners
      searchBtn.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    }

    // Initialize Mapbox when mapping content is shown
    function initMappingContent() {
      const mappingContent = document.getElementById('mapping-content');
      if (mappingContent && mappingContent.style.display !== 'none') {
        setTimeout(initMapbox, 100);
      }
    }

    // Watch for mapping content changes
    const mappingObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'mapping-content' && mutation.target.style.display !== 'none') {
            setTimeout(initMapbox, 100);
          }
        }
      });
    });

    // Start observing mapping content
    if (document.getElementById('mapping-content')) {
      mappingObserver.observe(document.getElementById('mapping-content'), { attributes: true });
    }

    // ============================================================================
    // SUBWAY STATIONS MAPBOX
    // ============================================================================
    
    let advancedMap = null;

    function initAdvancedMapbox() {
      const mapContainer = document.getElementById('advanced-map');
      if (!mapContainer) {
        console.error('Advanced map container not found!');
        return;
      }
      
      console.log('Advanced map container found:', mapContainer);
      console.log('Container dimensions:', mapContainer.offsetWidth, 'x', mapContainer.offsetHeight);

      // Set your Mapbox access token
      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      // Initialize the advanced map
      advancedMap = new mapboxgl.Map({
        container: 'advanced-map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-73.9654, 40.7829], // Central Park
        zoom: 13,
        pitch: 0,
        bearing: 0
      });

      // Add navigation controls
      advancedMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
      advancedMap.addControl(new mapboxgl.FullscreenControl(), 'top-right');

            // GeoJSON data for Manhattan subway stations
      const manhattanFeatures = {
        type: 'FeatureCollection',
        features: [
          // Subway Stations - Red Dots
          {
            type: 'Feature',
            id: 'times-square-station',
            properties: {
              name: 'Times Square - 42nd Street',
              type: 'subway-station',
              lines: '1, 2, 3, 7, N, Q, R, W, S',
              description: 'Major subway hub serving multiple lines',
              daily_riders: '200,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9875, 40.7580]
            }
          },
          {
            type: 'Feature',
            id: 'grand-central-station',
            properties: {
              name: 'Grand Central Terminal',
              type: 'subway-station',
              lines: '4, 5, 6, 7, S',
              description: 'Historic train terminal and subway station',
              daily_riders: '750,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9770, 40.7520]
            }
          },
          {
            type: 'Feature',
            id: 'union-square-station',
            properties: {
              name: 'Union Square',
              type: 'subway-station',
              lines: '4, 5, 6, L, N, Q, R, W',
              description: 'Major subway hub in downtown Manhattan',
              daily_riders: '150,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9905, 40.7360]
            }
          },
          {
            type: 'Feature',
            id: 'penn-station',
            properties: {
              name: 'Penn Station',
              type: 'subway-station',
              lines: '1, 2, 3, A, C, E',
              description: 'Major transportation hub for trains and subways',
              daily_riders: '600,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9930, 40.7500]
            }
          },
          {
            type: 'Feature',
            id: 'fulton-street-station',
            properties: {
              name: 'Fulton Street',
              type: 'subway-station',
              lines: '2, 3, 4, 5, A, C, J, Z',
              description: 'Major downtown subway hub',
              daily_riders: '100,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9890, 40.7100]
            }
          },
          {
            type: 'Feature',
            id: 'canal-street-station',
            properties: {
              name: 'Canal Street',
              type: 'subway-station',
              lines: '6, J, N, Q, R, W, Z',
              description: 'Major subway station in Chinatown',
              daily_riders: '80,000+',
              accessibility: 'Partial'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9990, 40.7180]
            }
          },
          {
            type: 'Feature',
            id: '14th-street-station',
            properties: {
              name: '14th Street',
              type: 'subway-station',
              lines: '1, 2, 3, F, L, M',
              description: 'Major subway hub in Chelsea',
              daily_riders: '120,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9960, 40.7370]
            }
          },
          {
            type: 'Feature',
            id: '34th-street-station',
            properties: {
              name: '34th Street - Herald Square',
              type: 'subway-station',
              lines: 'B, D, F, M, N, Q, R, W',
              description: 'Major subway hub near Macy\'s',
              daily_riders: '180,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9870, 40.7490]
            }
          },
          {
            type: 'Feature',
            id: '59th-street-station',
            properties: {
              name: '59th Street - Columbus Circle',
              type: 'subway-station',
              lines: '1, A, B, C, D',
              description: 'Major subway hub near Central Park',
              daily_riders: '100,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9810, 40.7680]
            }
          },
          {
            type: 'Feature',
            id: '125th-street-station',
            properties: {
              name: '125th Street',
              type: 'subway-station',
              lines: '4, 5, 6, A, B, C, D',
              description: 'Major subway hub in Harlem',
              daily_riders: '80,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9370, 40.8040]
            }
          }
        ]
      };

            // Wait for map to load
      advancedMap.on('load', function() {
        console.log('Subway stations map loaded successfully!');
        
        // Add GeoJSON source
        advancedMap.addSource('manhattan-features', {
          type: 'geojson',
          data: manhattanFeatures
        });
        
        console.log('GeoJSON source added, subway stations:', manhattanFeatures.features.length);
        
        // Add subway stations as red dots
        advancedMap.addLayer({
          id: 'subway-stations',
          type: 'circle',
          source: 'manhattan-features',
          paint: {
            'circle-radius': 12,
            'circle-color': '#F44336',
            'circle-stroke-color': '#D32F2F',
            'circle-stroke-width': 3,
            'circle-opacity': 1.0
          }
        });
        
        console.log('Subway stations layer added successfully');

        // Add hover effects for subway stations
        advancedMap.on('mouseenter', 'subway-stations', function(e) {
          if (e.features.length > 0) {
            advancedMap.getCanvas().style.cursor = 'pointer';
            const feature = e.features[0];
            const popup = new mapboxgl.Popup({
              closeButton: false,
              closeOnClick: false
            });
            
            popup.setLngLat(e.lngLat)
              .setHTML(`
                <h3>${feature.properties.name}</h3>
                <p><strong>Type:</strong> ${feature.properties.type}</p>
                <p><strong>Description:</strong> ${feature.properties.description}</p>
                ${feature.properties.lines ? `<p><strong>Subway Lines:</strong> ${feature.properties.lines}</p>` : ''}
                ${feature.properties.daily_riders ? `<p><strong>Daily Riders:</strong> ${feature.properties.daily_riders}</p>` : ''}
                ${feature.properties.accessibility ? `<p><strong>Accessibility:</strong> ${feature.properties.accessibility}</p>` : ''}
              `)
              .addTo(advancedMap);
            
            feature.popup = popup;
          }
        });

        advancedMap.on('mouseleave', 'subway-stations', function(e) {
          advancedMap.getCanvas().style.cursor = '';
          if (e.features.length > 0 && e.features[0].popup) {
            e.features[0].popup.remove();
          }
        });

        // Add click interactions for subway stations
        advancedMap.on('click', 'subway-stations', function(e) {
          if (e.features.length > 0) {
            const feature = e.features[0];
            new mapboxgl.Popup()
              .setLngLat(e.lngLat)
              .setHTML(`
                <div style="max-width: 300px;">
                  <h2>${feature.properties.name}</h2>
                  <p><strong>Type:</strong> ${feature.properties.type}</p>
                  <p>${feature.properties.description}</p>
                  ${feature.properties.lines ? `<p><strong>Subway Lines:</strong> ${feature.properties.lines}</p>` : ''}
                  ${feature.properties.daily_riders ? `<p><strong>Daily Riders:</strong> ${feature.properties.daily_riders}</p>` : ''}
                  ${feature.properties.accessibility ? `<p><strong>Accessibility:</strong> ${feature.properties.accessibility}</p>` : ''}
                </div>
              `)
              .addTo(advancedMap);
          }
        });
      });

      // Add reset view functionality
      document.getElementById('reset-view').addEventListener('click', function() {
        advancedMap.flyTo({
          center: [-73.9654, 40.7829],
          zoom: 13,
          pitch: 0,
          bearing: 0,
          duration: 2000
        });
      });
    }

    // Initialize advanced map when mapping content is shown
    function initAdvancedMappingContent() {
      const mappingContent = document.getElementById('mapping-content');
      if (mappingContent && mappingContent.style.display !== 'none') {
        setTimeout(() => {
          initMapbox();
          initAdvancedMapbox();
        }, 100);
      }
    }

    // Update the existing mapping observer to include advanced map
    const advancedMappingObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'mapping-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initMapbox();
              initAdvancedMapbox();
            }, 100);
          }
        }
      });
    });

    // Start observing mapping content for advanced map
    if (document.getElementById('mapping-content')) {
      advancedMappingObserver.observe(document.getElementById('mapping-content'), { attributes: true });
    }

    // ============================================================================
    // DAILY ROUTINE MAPBOX
    // ============================================================================
    
    let routineMap = null;

    function initRoutineMapbox() {
      const mapContainer = document.getElementById('routine-map');
      if (!mapContainer) {
        console.error('Routine map container not found!');
        return;
      }
      
      console.log('Routine map container found:', mapContainer);

      // Set your Mapbox access token
      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      // Initialize the routine map
      routineMap = new mapboxgl.Map({
        container: 'routine-map',
        style: 'mapbox://styles/mapbox/light-v11',
        center: [-73.9710, 40.7880], // Midpoint between 56th St and Columbia
        zoom: 13,
        pitch: 0,
        bearing: 0
      });

      // Add navigation controls
      routineMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
      routineMap.addControl(new mapboxgl.FullscreenControl(), 'top-right');

      // Wait for map to load
      routineMap.on('load', function() {
        console.log('Routine map loaded successfully!');
        
        // Load the GeoJSON file
        fetch('my_routine.geojson')
          .then(response => response.json())
          .then(data => {
            console.log('Routine data loaded:', data);
            
            // Add GeoJSON source
            routineMap.addSource('routine-data', {
              type: 'geojson',
              data: data
            });
            
            // Add route line
            routineMap.addLayer({
              id: 'route-line',
              type: 'line',
              source: 'routine-data',
              filter: ['==', ['geometry-type'], 'LineString'],
              paint: {
                'line-color': '#FF6B6B',
                'line-width': 4,
                'line-opacity': 0.8
              }
            });
            
            // Add location points
            routineMap.addLayer({
              id: 'routine-points',
              type: 'circle',
              source: 'routine-data',
              filter: ['==', ['geometry-type'], 'Point'],
              paint: {
                'circle-radius': 10,
                'circle-color': '#4ECDC4',
                'circle-stroke-color': '#2C3E50',
                'circle-stroke-width': 2,
                'circle-opacity': 0.8
              }
            });
            
            // Add labels for points
            routineMap.addLayer({
              id: 'routine-labels',
              type: 'symbol',
              source: 'routine-data',
              filter: ['==', ['geometry-type'], 'Point'],
              layout: {
                'text-field': ['get', 'name'],
                'text-size': 14,
                'text-offset': [0, -1.5],
                'text-anchor': 'bottom'
              },
              paint: {
                'text-color': '#2C3E50',
                'text-halo-color': '#FFFFFF',
                'text-halo-width': 1
              }
            });
            
            console.log('Routine layers added successfully');
            
            // Fit map to data bounds
            const bounds = new mapboxgl.LngLatBounds();
            data.features.forEach(feature => {
              if (feature.geometry.type === 'Point') {
                bounds.extend(feature.geometry.coordinates);
              } else if (feature.geometry.type === 'LineString') {
                feature.geometry.coordinates.forEach(coord => {
                  bounds.extend(coord);
                });
              }
            });
            
            routineMap.fitBounds(bounds, {
              padding: 50,
              duration: 2000
            });
            
          })
          .catch(error => {
            console.error('Error loading routine data:', error);
          });
      });

      // Add hover effects for routine points
      routineMap.on('mouseenter', 'routine-points', function(e) {
        if (e.features.length > 0) {
          routineMap.getCanvas().style.cursor = 'pointer';
          const feature = e.features[0];
          const popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
          });
          
          popup.setLngLat(e.lngLat)
            .setHTML(`
              <h3>${feature.properties.name}</h3>
              <p><strong>Time:</strong> ${feature.properties.time}</p>
              <p><strong>Activity:</strong> ${feature.properties.activity}</p>
              <p><strong>Duration:</strong> ${feature.properties.duration}</p>
            `)
            .addTo(routineMap);
          
          feature.popup = popup;
        }
      });

      routineMap.on('mouseleave', 'routine-points', function(e) {
        routineMap.getCanvas().style.cursor = '';
        if (e.features.length > 0 && e.features[0].popup) {
          e.features[0].popup.remove();
        }
      });

      // Add click interactions for routine points
      routineMap.on('click', 'routine-points', function(e) {
        if (e.features.length > 0) {
          const feature = e.features[0];
          new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`
              <div style="max-width: 250px;">
                <h2>${feature.properties.name}</h2>
                <p><strong>Time:</strong> ${feature.properties.time}</p>
                <p><strong>Activity:</strong> ${feature.properties.activity}</p>
                <p><strong>Duration:</strong> ${feature.properties.duration}</p>
              </div>
            `)
            .addTo(routineMap);
        }
      });
    }

    // Initialize routine map when mapping content is shown
    function initRoutineMappingContent() {
      const mappingContent = document.getElementById('mapping-content');
      if (mappingContent && mappingContent.style.display !== 'none') {
        setTimeout(() => {
          initMapbox();
          initAdvancedMapbox();
          initRoutineMapbox();
        }, 100);
      }
    }

    // Update the existing mapping observer to include routine map
    const routineMappingObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'mapping-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initMapbox();
              initAdvancedMapbox();
              initRoutineMapbox();
            }, 100);
          }
        }
      });
    });

    // Start observing mapping content for routine map
    if (document.getElementById('mapping-content')) {
      routineMappingObserver.observe(document.getElementById('mapping-content'), { attributes: true });
    }

  </script>

  <!-- Firebase Poll App Content Section (hidden by default) -->
  <div id="firebasepoll-content" class="tool-content" style="display: none; max-width: 500px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 32px 24px;">
    <div id="poll-section-firebase">
      <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 18px;">Can I be your favorite person?</h3>
      <form id="poll-form-firebase" style="margin-bottom: 18px;">
        <input type="radio" name="student" value="Yes" id="yes-firebase" style="margin-right: 6px;" />
        <label for="yes-firebase" style="margin-right: 18px; font-size: 1rem;">Yes</label>
        <input type="radio" name="student" value="No" id="no-firebase" style="margin-right: 6px;" />
        <label for="no-firebase" style="font-size: 1rem;">No</label>
        <br />
        <button type="submit" style="margin-top: 16px; padding: 8px 20px; background: #1f77b4; color: #fff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">Vote</button>
      </form>
      <div id="poll-results-firebase" style="margin-top: 16px; font-size: 1rem;"></div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid #eee;" />

      <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 18px;">How are you doing?</h3>
      <form id="howareyou-form-firebase" style="margin-bottom: 18px;">
        <input type="radio" name="howareyou" value="Good" id="good-firebase" style="margin-right: 6px;" />
        <label for="good-firebase" style="margin-right: 18px; font-size: 1rem;">Good</label>
        <input type="radio" name="howareyou" value="Okay" id="okay-firebase" style="margin-right: 6px;" />
        <label for="okay-firebase" style="margin-right: 18px; font-size: 1rem;">Okay</label>
        <input type="radio" name="howareyou" value="Tired" id="tired-firebase" style="margin-right: 6px;" />
        <label for="tired-firebase" style="margin-right: 18px; font-size: 1rem;">Tired</label>
        <input type="radio" name="howareyou" value="Others" id="others-firebase" style="margin-right: 6px;" />
        <label for="others-firebase" style="font-size: 1rem;">Others</label>
        <br />
        <button type="submit" style="margin-top: 16px; padding: 8px 20px; background: #1f77b4; color: #fff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">Vote</button>
      </form>
      <div id="howareyou-results-firebase" style="margin-top: 16px; font-size: 1rem;"></div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid #eee;" />

      <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 18px;">What motivates you the most?</h3>
      <form id="motivation-form-firebase" style="margin-bottom: 18px;">
        <div style="margin-bottom: 10px;">
          <input type="radio" name="motivation" value="Personal Passion" id="motivation-passion" style="margin-right: 8px;" />
          <label for="motivation-passion" style="font-size: 1rem;">Personal Passion</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="motivation" value="Financial Reward" id="motivation-financial" style="margin-right: 8px;" />
          <label for="motivation-financial" style="font-size: 1rem;">Financial Reward</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="motivation" value="Public Recognition" id="motivation-recognition" style="margin-right: 8px;" />
          <label for="motivation-recognition" style="font-size: 1rem;">Public Recognition</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="motivation" value="Collaboration with Others" id="motivation-collaboration" style="margin-right: 8px;" />
          <label for="motivation-collaboration" style="font-size: 1rem;">Collaboration with Others</label>
        </div>
        <button type="submit" style="margin-top: 8px; padding: 8px 20px; background: #1f77b4; color: #fff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">Vote</button>
      </form>
      <div id="motivation-results-firebase" style="margin-top: 16px; font-size: 1rem;"></div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid #eee;" />

      <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 18px;">Which method of data collection do you trust the most?</h3>
      <form id="datatrust-form-firebase" style="margin-bottom: 18px;">
        <div style="margin-bottom: 10px;">
          <input type="radio" name="datatrust" value="Surveys" id="datatrust-surveys" style="margin-right: 8px;" />
          <label for="datatrust-surveys" style="font-size: 1rem;">Surveys</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="datatrust" value="Interviews" id="datatrust-interviews" style="margin-right: 8px;" />
          <label for="datatrust-interviews" style="font-size: 1rem;">Interviews</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="datatrust" value="Observations" id="datatrust-observations" style="margin-right: 8px;" />
          <label for="datatrust-observations" style="font-size: 1rem;">Observations</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="datatrust" value="Sensor/IoT Data" id="datatrust-sensor" style="margin-right: 8px;" />
          <label for="datatrust-sensor" style="font-size: 1rem;">Sensor/IoT Data</label>
        </div>
        <div style="margin-bottom: 10px;">
          <input type="radio" name="datatrust" value="Web & App Analytics" id="datatrust-analytics" style="margin-right: 8px;" />
          <label for="datatrust-analytics" style="font-size: 1rem;">Web & App Analytics</label>
        </div>
        <button type="submit" style="margin-top: 8px; padding: 8px 20px; background: #1f77b4; color: #fff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">Vote</button>
      </form>
      <div id="datatrust-results-firebase" style="margin-top: 16px; font-size: 1rem;"></div>
    </div>
    <!-- Firebase SDK and poll logic -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyATihgXVJqhja1rZPE0rL06y83MR5fS-dc",
        authDomain: "poll-tutorial-6726b.firebaseapp.com",
        projectId: "poll-tutorial-6726b",
        storageBucket: "poll-tutorial-6726b.firebasestorage.app",
        messagingSenderId: "1013845591191",
        appId: "1:1013845591191:web:6325973ef3ea5f3dde55d2",
        measurementId: "G-E6WHNL5TPR"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Poll 1 logic
      const pollForm = document.getElementById('poll-form-firebase');
      const pollResults = document.getElementById('poll-results-firebase');
      pollForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const answer = document.querySelector('input[name="student"]:checked');
        if (!answer) {
          alert('Please select an option.');
          return;
        }
        await db.collection('studentPoll').add({ answer: answer.value });
        pollForm.reset();
      });
      function renderResults(counts) {
        pollResults.innerHTML = `
          <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
          <ul style='list-style:none; padding:0;'>
            <li style='margin-bottom:6px;'>Yes: <strong>${counts['Yes']}</strong></li>
            <li>No: <strong>${counts['No']}</strong></li>
          </ul>
        `;
      }
      db.collection('studentPoll').onSnapshot(function(snapshot) {
        const counts = { 'Yes': 0, 'No': 0 };
        snapshot.forEach(function(doc) {
          const answer = doc.data().answer;
          if (counts[answer] !== undefined) counts[answer]++;
        });
        renderResults(counts);
      });

      // Poll 2 logic
      const howAreYouForm = document.getElementById('howareyou-form-firebase');
      const howAreYouResults = document.getElementById('howareyou-results-firebase');
      howAreYouForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const answer = document.querySelector('input[name="howareyou"]:checked');
        if (!answer) {
          alert('Please select an option.');
          return;
        }
        await db.collection('howAreYouPoll').add({ answer: answer.value });
        howAreYouForm.reset();
      });
      function renderHowAreYouResults(counts) {
        howAreYouResults.innerHTML = `
          <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
          <ul style='list-style:none; padding:0;'>
            <li style='margin-bottom:6px;'>Good: <strong>${counts['Good']}</strong></li>
            <li style='margin-bottom:6px;'>Okay: <strong>${counts['Okay']}</strong></li>
            <li style='margin-bottom:6px;'>Tired: <strong>${counts['Tired']}</strong></li>
            <li>Others: <strong>${counts['Others']}</strong></li>
          </ul>
        `;
      }
      db.collection('howAreYouPoll').onSnapshot(function(snapshot) {
        const counts = { 'Good': 0, 'Okay': 0, 'Tired': 0, 'Others': 0 };
        snapshot.forEach(function(doc) {
          const answer = doc.data().answer;
          if (counts[answer] !== undefined) counts[answer]++;
        });
        renderHowAreYouResults(counts);
      });

      // Poll 3 logic
      const motivationForm = document.getElementById('motivation-form-firebase');
      const motivationResults = document.getElementById('motivation-results-firebase');
      motivationForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const motivation = document.querySelector('input[name="motivation"]:checked');
        if (!motivation) {
          alert('Please select an option.');
          return;
        }
        await db.collection('motivationPoll').add({ answer: motivation.value });
        motivationForm.reset();
      });
      function renderMotivationResults(counts) {
        motivationResults.innerHTML = `
          <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
          <ul style='list-style:none; padding:0;'>
            <li style='margin-bottom:6px;'>Personal Passion: <strong>${counts['Personal Passion']}</strong></li>
            <li style='margin-bottom:6px;'>Financial Reward: <strong>${counts['Financial Reward']}</strong></li>
            <li style='margin-bottom:6px;'>Public Recognition: <strong>${counts['Public Recognition']}</strong></li>
            <li style='margin-bottom:6px;'>Collaboration with Others: <strong>${counts['Collaboration with Others']}</strong></li>
          </ul>
        `;
      }
      db.collection('motivationPoll').onSnapshot(function(snapshot) {
        const counts = { 'Personal Passion': 0, 'Financial Reward': 0, 'Public Recognition': 0, 'Collaboration with Others': 0 };
        snapshot.forEach(function(doc) {
          const answer = doc.data().answer;
          if (counts[answer] !== undefined) counts[answer]++;
        });
        renderMotivationResults(counts);
      });

      // Poll 4 logic
      const datatrustForm = document.getElementById('datatrust-form-firebase');
      const datatrustResults = document.getElementById('datatrust-results-firebase');
      datatrustForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const datatrust = document.querySelector('input[name="datatrust"]:checked');
        if (!datatrust) {
          alert('Please select an option.');
          return;
        }
        await db.collection('dataTrustPoll').add({ answer: datatrust.value });
        datatrustForm.reset();
      });
      function renderDatatrustResults(counts) {
        datatrustResults.innerHTML = `
          <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
          <ul style='list-style:none; padding:0;'>
            <li style='margin-bottom:6px;'>Surveys: <strong>${counts['Surveys']}</strong></li>
            <li style='margin-bottom:6px;'>Interviews: <strong>${counts['Interviews']}</strong></li>
            <li style='margin-bottom:6px;'>Observations: <strong>${counts['Observations']}</strong></li>
            <li style='margin-bottom:6px;'>Sensor/IoT Data: <strong>${counts['Sensor/IoT Data']}</strong></li>
            <li style='margin-bottom:6px;'>Web & App Analytics: <strong>${counts['Web & App Analytics']}</strong></li>
          </ul>
        `;
      }
      db.collection('dataTrustPoll').onSnapshot(function(snapshot) {
        const counts = { 'Surveys': 0, 'Interviews': 0, 'Observations': 0, 'Sensor/IoT Data': 0, 'Web & App Analytics': 0 };
        snapshot.forEach(function(doc) {
          const answer = doc.data().answer;
          if (counts[answer] !== undefined) counts[answer]++;
        });
        renderDatatrustResults(counts);
      });
    </script>
  </div>

</body>
</html> 