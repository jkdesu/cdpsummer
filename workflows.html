<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Workflows</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  
  <!-- Chart-specific styles -->
  <style>
    /* Container styles */
    .timeline-container {
      margin: 2rem 0;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      max-width: 100%;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    /* Chart element styles */
    .artist-bar {
      cursor: pointer;
      transition: opacity 0.3s;
    }
    
    .artist-bar:hover {
      opacity: 0.8;
    }
    
    /* Tooltip styles */
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
    }
    
    /* Artwork modal styles */
    .artwork-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      text-align: center;
      position: relative;
    }
    
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    
    .modal-close:hover {
      color: #000;
    }
    
    .artwork-image {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      margin: 10px 0;
    }
    
    .artist-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .artwork-title {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    
    /* Legend styles */
    .category-legend {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }
    
    /* Link box hover effects */
    .workflow-link-box {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      min-width: 150px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .workflow-link-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: #007bff;
      background: #ffffff;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <span class="header-left">Ji-in Kang</span>
    <span class="header-right">Columbia University CDP 2025</span>
  </header>
  
  <!-- Navigation -->
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="colloquium1.html">Colloquium 1</a></li>
      <li><a href="modelling.html">Computational Modelling</a></li>
      <li><a href="mapping.html">Mapping Systems</a></li>
    </ul>
  </nav>
  
  <!-- Main content -->
  <main style="max-width: 1400px; margin: 0 auto; padding: 48px 32px 48px 32px;">
    <h2>Computational Design Workflows</h2>
    

    
    <h2>Exploring Contemporary Artist</h2>
    
    <!-- Workflow Tools Section -->
    <section>
      <h3>Design Workflow Tools</h3>
      <ul>
        <li><a href="#" onclick="showToolContent('p5js')">p5.js</a></li>
        <li><a href="#" onclick="showToolContent('threejs')">three.js</a></li>
        <li><a href="#" onclick="showToolContent('d3js')">d3.js</a></li>
        <li><a href="#" onclick="showToolContent('mapping')">exploring mapping</a></li>
      </ul>
    </section>
    
    <!-- Tool Content Sections -->
    <div id="p5js-content" class="tool-content" style="display: none;">
      <h3>p5.js: Creative Coding</h3>
      
      <!-- First Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch1" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch2" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch3" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch4" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 4</p>
        </div>
      </div>
      
      <!-- Second Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch5" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 5</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch6" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 6</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch7" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 7</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch8" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Random Gradient 8</p>
        </div>
      </div>
      
      <!-- Third Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch9" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch10" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch11" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch12" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">3D Animated Object 4</p>
        </div>
      </div>
      
      <!-- Fourth Row of Artworks -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="p5sketch13" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch14" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch15" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 3</p>
        </div>
        
        <div style="text-align: center;">
          <div id="p5sketch16" style="width: 280px; height: 280px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">HSB 3D Layers 4</p>
        </div>
      </div>
      

    </div>
    
    <div id="threejs-content" class="tool-content" style="display: none;">
      <h3>Three.js: 3D Graphics</h3>
      
      <!-- Three.js Canvases Row -->
      <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap; max-width: 1200px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center;">
          <div id="threejs-canvas1" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 1</p>
        </div>
        
        <div style="text-align: center;">
          <div id="threejs-canvas2" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 2</p>
        </div>
        
        <div style="text-align: center;">
          <div id="threejs-canvas3" style="width: 380px; height: 380px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">Three.js Scene 3</p>
        </div>
      </div>
    </div>
    
    <div id="d3js-content" class="tool-content" style="display: none;">
      <h3>D3.js: Data Visualization</h3>
      
      <h4>Exploring Contemporary Artist</h4>
      
      <!-- Temporal Structure -->
      <div class="timeline-container">
        <h5>Temporal Structure</h5>
        <div id="timeline-chart"></div>
        <div class="category-legend" id="legend"></div>
      </div>
      
      <!-- Relational Structure -->
      <div class="timeline-container">
        <h5>Relational Structure</h5>
        <div id="relational-graph"></div>
      </div>
    </div>
    
    <div id="mapping-content" class="tool-content" style="display: none;">
      <h3>Exploring Mapping: Spatial Analysis</h3>
    </div>    
  </main>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  d3.csv("relational_fixed.csv").then(function(linksRaw) {
    const groupMap = {};
    const nodeMap = new Map();
  
    linksRaw.forEach(d => {
      const name = d.name.trim();
      const category = d.category.trim();
      let key = "";
  
      if (category === "education") {
        key = d.education.trim();
        nodeMap.set(key, { id: key, type: "education" });
      } else if (category === "nationality") {
        key = d.nationality.trim();
        nodeMap.set(key, { id: key, type: "nationality" });
      } else if (category === "gallery") {
        key = d.education.trim();
        nodeMap.set(key, { id: key, type: "gallery" });
      } else if (category === "exhibition_country") {
        key = d.nationality.trim();
        nodeMap.set(key, { id: key, type: "exhibition_country" });
      }
  
      if (!groupMap[key]) groupMap[key] = [];
      groupMap[key].push(name);
  
      // Ensure artist node is added
      if (!nodeMap.has(name)) {
        nodeMap.set(name, { id: name, type: "artist" });
      }
    });
  
    // ==================== BUILD LINKS ====================
    const links = [];
    Object.entries(groupMap).forEach(([key, members]) => {
      for (let i = 0; i < members.length; i++) {
        links.push({ source: members[i], target: key, type: nodeMap.get(key).type });
      }
    });
  
    const nodes = Array.from(nodeMap.values());
  
    // ==================== COLORS & RADIUS ====================
    const colorScale = {
      artist: "#1f77b4",
      education: "#2ca02c",
      gallery: "#ff7f0e",
      nationality: "#9467bd",
      exhibition_country: "#e377c2"
    };
  
    const radiusScale = {
      artist: 18,
      education: 14,
      gallery: 14,
      nationality: 14,
      exhibition_country: 14
    };
  
    // ==================== CANVAS ====================
    const width = 1200, height = 700;
    const svg = d3.select("#relational-graph")
      .html("")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .style("background", "#fafbfc")
      .style("border-radius", "10px");
  
    const zoomGroup = svg.append("g");
    svg.call(
      d3.zoom()
        .scaleExtent([0.5, 4])
        .on("zoom", event => zoomGroup.attr("transform", event.transform))
    );
  
    const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(100))
      .force("charge", d3.forceManyBody().strength(-300))
      .force("center", d3.forceCenter(width / 2, height / 2));
  
    // ==================== DRAW LINKS ====================
    const link = zoomGroup.append("g")
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", 1.5)
      .attr("stroke", d => colorScale[d.type] || "#ccc")
      .attr("stroke-opacity", 0.6);
  
    // ==================== DRAW NODES ====================
    const node = zoomGroup.append("g")
      .selectAll("g")
      .data(nodes)
      .join("g")
      .attr("class", "node")
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended)
      );
  
    node.append("circle")
      .attr("r", d => radiusScale[d.type] || 10)
      .attr("fill", d => colorScale[d.type] || "#ccc")
      .attr("stroke", "#333")
      .attr("stroke-width", 1.5);
  
    node.append("text")
      .attr("dy", 4)
      .attr("x", d => radiusScale[d.type] + 4)
      .style("font-size", "11px")
      .style("pointer-events", "none")
      .text(d => d.id);
  
    // ==================== TOOLTIP ====================
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("padding", "6px 10px")
      .style("background", "#fff")
      .style("border", "1px solid #ccc")
      .style("border-radius", "4px")
      .style("pointer-events", "none")
      .style("font-size", "12px");
  
    const labelMap = {
      artist: "Artist",
      education: "Education (School)",
      gallery: "Gallery",
      nationality: "Nationality",
      exhibition_country: "Exhibition Country"
    };
  
    node.on("mouseover", function(event, d) {
      tooltip.transition().duration(200).style("opacity", 1);
      tooltip.html(`<strong>${d.id}</strong><br><span style="color:#666">${labelMap[d.type] || "Unknown"}</span>`)
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 20) + "px");
  
      node.selectAll("circle").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
      node.selectAll("text").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
      link.transition().duration(200).style("opacity", l => l.source.id === d.id || l.target.id === d.id ? 1 : 0.05);
    }).on("mouseout", function() {
      tooltip.transition().duration(200).style("opacity", 0);
      node.selectAll("circle").transition().duration(200).style("opacity", 1);
      node.selectAll("text").transition().duration(200).style("opacity", 1);
      link.transition().duration(200).style("opacity", 0.6);
    });
  
    simulation.on("tick", () => {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);
  
      node.attr("transform", d => {
        d.x = Math.max(20, Math.min(width - 20, d.x));
        d.y = Math.max(20, Math.min(height - 20, d.y));
        return `translate(${d.x},${d.y})`;
      });
    });
  
    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }
    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }
    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }
  
    // ==================== LEGEND ====================
    const legendData = Object.entries(colorScale).map(([type, color]) => ({
      label: labelMap[type],
      color
    }));
  
    const legend = svg.append("g")
      .attr("transform", `translate(${width - 220}, 20)`);
  
    legend.selectAll("rect")
      .data(legendData)
      .join("rect")
      .attr("x", 0)
      .attr("y", (d, i) => i * 22)
      .attr("width", 14)
      .attr("height", 14)
      .attr("fill", d => d.color);
  
    legend.selectAll("text")
      .data(legendData)
      .join("text")
      .attr("x", 20)
      .attr("y", (d, i) => i * 22 + 11)
      .style("font-size", "13px")
      .style("fill", "#333")
      .text(d => d.label);
  });
  </script>  
  <!-- Artwork Modal -->
  <div class="artwork-modal" id="artworkModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeArtworkModal()">&times;</span>
      <div class="artist-name" id="modalArtistName"></div>
      <div class="artwork-title" id="modalArtworkTitle"></div>
      <img class="artwork-image" id="modalArtworkImage" src="" alt="Artwork">
    </div>
  </div>
  
  <!-- JavaScript for D3.js visualization -->
  <script>
    // ============================================================================
    // INITIALIZATION
    // ============================================================================
    
    document.addEventListener('DOMContentLoaded', function() {
      loadArtistTimeline();
    });
    
    // ============================================================================
    // ARTWORK DATA
    // ============================================================================
    
    const artworkData = {
      "Jean-Michel BASQUIAT": {
        title: "Untitled (Skull)",
        image: "./temporal/1. Skull.jpg"
      },
      "Yoshitomo NARA": {
        title: "In The White Room",
        image: "./temporal/2. In The White Room .jpg"
      },
      "Jeff KOONS": {
        title: "Balloon Dog",
        image: "./temporal/3. Balloon Dog.jpg"
      },
      "Keith HARING": {
        title: "Dancing Figures",
        image: "./temporal/4. Dancing.jpg"
      },
      "Damien HIRST": {
        title: "The Physical Impossibility of Death in the Mind of Someone Living",
        image: "./temporal/5. Damien Hirst.jpg"
      },
      "Takashi MURAKAMI": {
        title: "My Lonesome Cowboy",
        image: "./temporal/6. Takashi.jpg"
      },
      "Mister": {
        title: "Harajuku Kiss",
        image: "./temporal/7. Harajuku Kiss.jpg"
      },
      "MADSAKI": {
        title: "If I Had a Dream",
        image: "./temporal/8. if i had a dream.jpg"
      },
      "Richard PRINCE": {
        title: "Untitled (Cowboy)",
        image: "./temporal/9. cowboy.jpg"
      },
      "Jonas WOOD": {
        title: "Interior with Two Chairs",
        image: "./temporal/10. Jonas Wood.jpg"
      },
      "Iwamoto MASAKAZU": {
        title: "Contemporary Painting",
        image: "./temporal/11. Iwamoto.jpg"
      },
      "Tyler HOBBS": {
        title: "Generative Art Composition",
        image: "./temporal/12. Tyler Hobbes.avif"
      },
      "Lee UFAN": {
        title: "Mono-ha Installation",
        image: "./temporal/13. LEE.jpg"
      },
      "KAWS": {
        title: "Companion",
        image: "./temporal/14. kaws.jpeg"
      },
      "Tom SACHS": {
        title: "Nutsy's",
        image: "./temporal/15. Tom.webp"
      },
      "Daniel ARSHAM": {
        title: "Fictional Archeology",
        image: "./temporal/16. Daniel.webp"
      }
    };
    
    // ============================================================================
    // DATA LOADING
    // ============================================================================
    
    function loadArtistTimeline() {
      d3.csv('temporal.csv')
        .then(function(data) {
          console.log('Loaded artist data:', data);
          createTimelineVisualization(data);
        })
        .catch(function(error) {
          console.error('Error loading CSV:', error);
        });
    }
    
    // ============================================================================
    // CHART CREATION
    // ============================================================================
    
    function createTimelineVisualization(data) {
      // Chart dimensions and margins - increased for better fit
      const margin = {top: 40, right: 40, bottom: 80, left: 180};
      const width = 1200 - margin.left - margin.right;
      const height = 600 - margin.top - margin.bottom;
      
      // Clear existing content
      d3.select("#timeline-chart").html("");
      
      // Create SVG container
      const svg = d3.select("#timeline-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);
      
      // Create scales
      const scales = createScales(data, width, height);
      
      // Add chart elements
      addAxes(svg, scales, height);
      addTimelineBars(svg, data, scales);
      addChartLabels(svg, width, height);
      
      // Create legend
      createLegend(scales.categories, scales.colorScale);
    }
    
    // ============================================================================
    // SCALE CREATION
    // ============================================================================
    
    function createScales(data, width, height) {
      // Time scale (X-axis)
      const timeExtent = d3.extent(data, d => [+d.start, +d.end]).flat();
      const xScale = d3.scaleLinear()
        .domain([d3.min(timeExtent), d3.max(timeExtent)])
        .range([0, width]);
      
      // Artist names scale (Y-axis)
      const yScale = d3.scaleBand()
        .domain(data.map(d => d.name))
        .range([0, height])
        .padding(0.1);
      
      // Color scale for categories
      const categories = [...new Set(data.map(d => d.category))];
      const colorScale = d3.scaleOrdinal()
        .domain(categories)
        .range(d3.schemeCategory10);
      
      return { xScale, yScale, colorScale, categories };
    }
    
    // ============================================================================
    // CHART ELEMENTS
    // ============================================================================
    
    function addAxes(svg, scales, height) {
      // X-axis (timeline)
      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(scales.xScale).tickFormat(d3.format("d")).ticks(10))
        .selectAll("text")
        .style("text-anchor", "middle")
        .style("font-size", "12px");
      
            // Y-axis (artist names)
      svg.append("g")
        .call(d3.axisLeft(scales.yScale))
        .selectAll("text")
        .style("text-anchor", "end")      // Right-aligns the text
        .style("font-size", "12px")
        .attr("dx", "-0.8em")             // Pulls text closer to the axis line
        .attr("dy", "0.35em")             // Vertically aligns text better
        .style("cursor", "pointer")        // Shows pointer cursor
        .on("click", function(event, d) {
          showArtworkModal(d);
        });
    }
    
    function addTimelineBars(svg, data, scales) {
      svg.selectAll(".artist-bar")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "artist-bar")
        .attr("x", d => scales.xScale(+d.start))
        .attr("y", d => scales.yScale(d.name))
        .attr("width", d => scales.xScale(+d.end) - scales.xScale(+d.start))
        .attr("height", scales.yScale.bandwidth())
        .attr("fill", d => scales.colorScale(d.category))
        .attr("stroke", "#333")
        .attr("stroke-width", 1)
        .on("mouseover", function(event, d) {
          showTooltip(event, d);
        })
        .on("mouseout", function() {
          hideTooltip();
        });
    }
    
    function addChartLabels(svg, width, height) {
      // Chart title
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", -15)
        .attr("text-anchor", "middle")
        .style("font-size", "18px")
        .style("font-weight", "bold")
        .text("Artist Timeline Analysis (1968-2025)");
      
      // X-axis label
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height + 40)
        .attr("text-anchor", "middle")
        .style("font-size", "14px")
        .text("Year");
    }
    
    // ============================================================================
    // INTERACTIVITY
    // ============================================================================
    
    function showTooltip(event, data) {
      const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 10) + "px");
      
      tooltip.html(`
        <strong>${data.name}</strong><br/>
        Period: ${data.start} - ${data.end}<br/>
        Category: ${data.category}<br/>
        Duration: ${+data.end - +data.start} years
      `);
    }
    
    function hideTooltip() {
      d3.selectAll(".tooltip").remove();
    }
    
    // ============================================================================
    // LEGEND CREATION
    // ============================================================================
    
    function createLegend(categories, colorScale) {
      const legend = d3.select("#legend");
      legend.html("");
      
      categories.forEach(category => {
        const item = legend.append("div")
          .attr("class", "legend-item");
        
        item.append("div")
          .attr("class", "legend-color")
          .style("background-color", colorScale(category));
        
        item.append("span")
          .text(category);
      });
    }
    
    // ============================================================================
    // ARTWORK MODAL FUNCTIONS
    // ============================================================================
    
    function showArtworkModal(artistName) {
      const artwork = artworkData[artistName];
      if (artwork) {
        document.getElementById("modalArtistName").textContent = artistName;
        document.getElementById("modalArtworkTitle").textContent = artwork.title;
        document.getElementById("modalArtworkImage").src = artwork.image;
        document.getElementById("modalArtworkImage").alt = artwork.title;
        document.getElementById("artworkModal").style.display = "flex";
      }
    }
    
    function closeArtworkModal() {
      document.getElementById("artworkModal").style.display = "none";
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById("artworkModal");
      if (event.target === modal) {
        closeArtworkModal();
      }
    });
    
    // ============================================================================
    // TOOL CONTENT NAVIGATION
    // ============================================================================
    
    function showToolContent(toolName) {
      // Hide all tool content sections
      const allToolContent = document.querySelectorAll('.tool-content');
      allToolContent.forEach(content => {
        content.style.display = 'none';
      });
      
      // Show the selected tool content
      const selectedContent = document.getElementById(toolName + '-content');
      if (selectedContent) {
        selectedContent.style.display = 'block';
      }
    }   
    
    // ============================================================================
    // P5.JS SKETCHES
    // ============================================================================
    
    // Sketch 1
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch1');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 2
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch2');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 4
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch4');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 5
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch5');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 6
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch6');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 7
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch7');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 8
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch8');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 9 - 3D Animated Object 1
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 10;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch9');
        p.angleMode(p.DEGREES);
        
        // Create a separate 2D graphics buffer for the background
        pixelBackground = p.createGraphics(280, 280, p.P2D);
      };
      
      p.draw = function() {
        generatePixelBackground(); // regenerate every frame

        // Draw the pixelated background onto the main canvas
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // move back
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();
        
        // 3D object
        p.noFill();
        p.stroke(255);
        
        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;
        
        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);
        
        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200); 

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function generatePixelBackground() {
        for (let y = 0; y < pixelBackground.height; y += pixelSize) {
          for (let x = 0; x < pixelBackground.width; x += pixelSize) {
            let r = p.random(30, 80);
            let g = p.random(30, 80);
            let b = p.random(30, 80);
            pixelBackground.fill(r, g, b);
            pixelBackground.noStroke();
            pixelBackground.rect(x, y, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 10 - 3D Animated Object 2
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch10');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 11 - 3D Animated Object 3
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch11');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 12 - 3D Animated Object 4
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 40;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch12');
        p.angleMode(p.DEGREES);

        // Create gradient buffer
        pixelBackground = p.createGraphics(280, 280, p.P2D);
        cols = 280 / pixelSize;
        rows = 280 / pixelSize;

        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
      };
      
      p.draw = function() {
        drawRandomGradient(pixelBackground);

        // Draw gradient texture background
        p.push();
        p.resetMatrix(); // reset WEBGL transform
        p.translate(-140, -140, -500); // push it far behind
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Animated Object
        p.noFill();
        p.stroke(255);

        let x = p.sin(p.frameCount * 2) * 30;
        let y = p.cos(p.frameCount) * 30;
        let z = p.sin(p.frameCount * 4) * 30;

        p.translate(x, y, z);
        p.rotateX(p.frameCount);
        p.rotateY(p.frameCount / 2);
        p.rotateZ(p.frameCount / 4);

        for (let i = 0; i < 360; i += 10) {
          p.push();
          let r = p.map(p.sin(i + p.frameCount), -1, 1, 200, 50);
          let g = p.map(p.sin(i + p.frameCount / 3), -1, 1, 50, 200);
          let b = p.map(p.cos(i + p.frameCount / 7), -1, 1, 50, 200);

          p.stroke(r, g, b);
          p.rotateY(i / 2);
          p.ellipse(0, 0, 120);
          p.pop();
        }
      };
      
      function drawRandomGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);

            gfx.noStroke();
            gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 13 - HSB 3D Layers 1
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch13');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 14 - HSB 3D Layers 2
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch14');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 15 - HSB 3D Layers 3
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch15');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    
    // Sketch 16 - HSB 3D Layers 4
    new p5(function(p) {
      let pixelBackground;
      let pixelSize = 20;
      let cols, rows;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280, p.WEBGL);
        canvas.parent('p5sketch16');
        p.angleMode(p.DEGREES);
        p.colorMode(p.HSB, 360, 100, 100, 100);
        p.noFill();

        pixelBackground = p.createGraphics(280, 280, p.P2D);
        pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

        cols = 280 / pixelSize;
        rows = 280 / pixelSize;
      };
      
      p.draw = function() {
        // Randomize corner colors every frame
        c1 = p.color(p.random(360), 80, 80);
        c2 = p.color(p.random(360), 80, 80);
        c3 = p.color(p.random(360), 80, 80);
        c4 = p.color(p.random(360), 80, 80);
        
        drawPixelatedGradient(pixelBackground);

        // Draw pixel background
        p.push();
        p.resetMatrix();
        p.translate(-140, -140, -500);
        p.texture(pixelBackground);
        p.noStroke();
        p.beginShape();
        p.vertex(0, 0, 0, 0);
        p.vertex(280, 0, 1, 0);
        p.vertex(280, 280, 1, 1);
        p.vertex(0, 280, 0, 1);
        p.endShape(p.CLOSE);
        p.pop();

        // 3D Object
        p.rotateY(p.frameCount * 0.3);
        p.rotateX(p.frameCount * 0.2);
        p.strokeWeight(1.2);

        for (let j = 0; j < 5; j++) {
          p.push();
          let zOffset = p.map(j, 0, 5, -100, 100);
          p.translate(0, 0, zOffset);

          for (let i = 0; i < 360; i += 10) {
            p.push();

            let hue = (i * 2 + p.frameCount * 2 + j * 30) % 360;
            let sat = p.map(p.sin(i + p.frameCount / 3), -1, 1, 60, 100);
            let bri = p.map(p.cos(i + p.frameCount / 5), -1, 1, 60, 100);
            p.stroke(hue, sat, bri, 80);

            p.rotateY(i + p.frameCount);
            let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
            p.ellipse(0, 0, radius, radius / 2);

            p.pop();
          }
          p.pop();
        }
      };
      
      function drawPixelatedGradient(gfx) {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;

            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);

            let h = p.hue(baseColor) + p.random(-5, 5);
            let s = p.saturation(baseColor) + p.random(-10, 10);
            let b = p.brightness(baseColor) + p.random(-10, 10);

            gfx.noStroke();
            gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
            gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });
    

    
    // Sketch 3
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch3');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255)); // top-left
        c2 = p.color(p.random(255), p.random(255), p.random(255)); // top-right
        c3 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-left
        c4 = p.color(p.random(255), p.random(255), p.random(255)); // bottom-right
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            // Blend top and bottom colors horizontally
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            // Add gentle noise
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });

  </script>
  
  <!-- Three.js Library and Scenes -->
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js';
    
    // Three.js Scene 1
    let scene1, camera1, renderer1;
    let rings1 = [];
    let time1 = 0;

    function initThreeJS1() {
      const container = document.getElementById('threejs-canvas1');
      if (!container) return;

      scene1 = new THREE.Scene();
      camera1 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera1.position.z = 200;

      renderer1 = new THREE.WebGLRenderer({ antialias: true });
      renderer1.setSize(380, 380);
      container.appendChild(renderer1.domElement);

      // Pixelated Gradient Background Plane
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04; // smaller = finer

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            // subtle noise
            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false,
        transparent: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene1.add(bgMesh);

      // Add rings
      const ringCount = 5;
      for (let j = 0; j < ringCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const radius = 50 + j * 10;
          const geo = new THREE.TorusGeometry(radius, 1.5, 8, 64);
          const mat = new THREE.MeshBasicMaterial({ color: new THREE.Color(`hsl(${(i * 2 + j * 30) % 360}, 100%, 60%)`) });
          const mesh = new THREE.Mesh(geo, mat);
          mesh.rotation.y = THREE.MathUtils.degToRad(i);
          group.add(mesh);
        }

        group.position.z = -50 + j * 25;
        rings1.push(group);
        scene1.add(group);
      }

      animate1();
    }

    function animate1() {
      requestAnimationFrame(animate1);
      time1 += 1;

      // Update pixel background shader
      if (scene1 && scene1.children[0]) {
        scene1.children[0].material.uniforms.time.value = time1;
      }

      // Rotate rings & animate color
      rings1.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time1 * 0.5 + j * 30) % 360;
          mesh.material.color.setHSL(hue / 360, 1, 0.6);
        });
      });

      if (renderer1 && scene1 && camera1) {
        renderer1.render(scene1, camera1);
      }
    }



    // Three.js Scene 2
    let scene2, camera2, renderer2;
    let ellipseGroups2 = [];
    let time2 = 0;

    function initThreeJS2() {
      const container = document.getElementById('threejs-canvas2');
      if (!container) return;

      scene2 = new THREE.Scene();
      camera2 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera2.position.z = 200;

      renderer2 = new THREE.WebGLRenderer({ antialias: true });
      renderer2.setSize(380, 380);
      container.appendChild(renderer2.domElement);

      // Pixelated Gradient Background Shader
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene2.add(bgMesh);

      // Create ellipse rings
      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.CircleGeometry(1, 64); // Circle, will scale to ellipse
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.8, side: THREE.DoubleSide });
          const ellipse = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          // Position around a ring
          ellipse.position.x = Math.cos(angle) * radius;
          ellipse.position.y = Math.sin(angle) * radius;
          ellipse.position.z = -50 + j * 25;

          // Make it look like an ellipse by squishing the Y axis
          ellipse.scale.set(10, 5, 1);

          group.add(ellipse);
        }

        ellipseGroups2.push(group);
        scene2.add(group);
      }

      animate2();
    }

    function animate2() {
      requestAnimationFrame(animate2);
      time2 += 1;

      // Update pixel background
      if (scene2 && scene2.children[0]) {
        scene2.children[0].material.uniforms.time.value = time2;
      }

      // Animate ellipses
      ellipseGroups2.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time2 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer2 && scene2 && camera2) {
        renderer2.render(scene2, camera2);
      }
    }

    // Initialize when Three.js content is shown
    function initThreeJSContent() {
      const threeJSContent = document.getElementById('threejs-content');
      if (threeJSContent && threeJSContent.style.display !== 'none') {
        setTimeout(() => {
          initThreeJS1();
          initThreeJS2();
        }, 100);
      }
    }

    // Watch for content changes
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'threejs-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initThreeJS1();
              initThreeJS2();
              initThreeJS3();
            }, 100);
          }
        }
      });
    });

    // Three.js Scene 3
    let scene3, camera3, renderer3;
    let rectangleGroups3 = [];
    let time3 = 0;

    function initThreeJS3() {
      const container = document.getElementById('threejs-canvas3');
      if (!container) return;

      scene3 = new THREE.Scene();
      camera3 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera3.position.z = 200;

      renderer3 = new THREE.WebGLRenderer({ antialias: true });
      renderer3.setSize(380, 380);
      container.appendChild(renderer3.domElement);

      // Pixelated Background Shader
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene3.add(bgMesh);

      // Create rectangle rings
      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.PlaneGeometry(8, 20); // Flat rectangle
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.9 });
          const rect = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          // Position it in a circle
          rect.position.x = Math.cos(angle) * radius;
          rect.position.y = Math.sin(angle) * radius;
          rect.position.z = -50 + j * 25;

          // Make it face outward
          rect.lookAt(0, 0, rect.position.z);

          group.add(rect);
        }

        rectangleGroups3.push(group);
        scene3.add(group);
      }

      animate3();
    }

    function animate3() {
      requestAnimationFrame(animate3);
      time3 += 1;

      // Animate background
      if (scene3 && scene3.children[0]) {
        scene3.children[0].material.uniforms.time.value = time3;
      }

      // Animate rectangles
      rectangleGroups3.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time3 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer3 && scene3 && camera3) {
        renderer3.render(scene3, camera3);
      }
    }



    // Start observing
    if (document.getElementById('threejs-content')) {
      observer.observe(document.getElementById('threejs-content'), { attributes: true });
    }
  </script>
</body>
</html> 