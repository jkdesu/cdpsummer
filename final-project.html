<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Final Project - Computational Design Workflows</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  
  <!-- Modern Design Styles -->
  <style>
    /* Modern Color Palette */
    :root {
      --primary-color: #6366f1;
      --secondary-color: #8b5cf6;
      --accent-color: #06b6d4;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --dark-bg: #0f172a;
      --card-bg: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Header Styles */
    .hero-header {
      background: var(--gradient-primary);
      color: white;
      padding: 4rem 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }

    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 1200px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #ffffff, #f0f9ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      opacity: 0.9;
      margin-bottom: 2rem;
      font-weight: 300;
    }

    .author-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 2rem;
    }

    .author-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5rem;
      color: white;
    }

    /* Navigation */
    .nav-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--border-color);
    }

    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-logo {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--primary-color);
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-primary);
      font-weight: 500;
      transition: color 0.3s ease;
      position: relative;
    }

    .nav-links a:hover {
      color: var(--primary-color);
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--gradient-primary);
      transition: width 0.3s ease;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    /* Main Content */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
    }

    /* Tool Cards */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 4rem;
    }

    .tool-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }

    .tool-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .tool-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .tool-card:hover::before {
      transform: scaleX(1);
    }

    .tool-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      background: var(--gradient-primary);
      color: white;
    }

    .tool-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .tool-description {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .tool-features {
      list-style: none;
      margin-top: 1rem;
    }

    .tool-features li {
      padding: 0.25rem 0;
      color: var(--text-secondary);
      position: relative;
      padding-left: 1.5rem;
    }

    .tool-features li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: var(--success-color);
      font-weight: bold;
    }

    /* Content Sections */
    .content-section {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 3rem;
      margin-bottom: 3rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border-color);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section-subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }

    /* P5.js Sketches Grid */
    .sketches-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .sketch-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .sketch-container:hover {
      transform: translateY(-5px);
    }

    .sketch-canvas {
      width: 100%;
      height: 280px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 1rem;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .sketch-title {
      font-weight: 600;
      color: var(--text-primary);
      text-align: center;
      font-size: 0.9rem;
    }

    /* D3.js Visualizations */
    .viz-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .viz-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    /* Map Containers */
    .map-container {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      margin: 2rem 0;
    }

    .map-controls {
      background: var(--card-bg);
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .search-container {
      display: flex;
      gap: 1rem;
      align-items: center;
      max-width: 400px;
      margin: 0 auto;
    }

    .search-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .search-btn {
      padding: 0.75rem 1.5rem;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .search-btn:hover {
      transform: translateY(-2px);
    }

    /* Firebase Poll Section */
    .poll-section {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 3rem;
      margin: 2rem 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .poll-question {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: var(--text-primary);
    }

    .poll-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .poll-option {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .poll-option:hover {
      border-color: var(--primary-color);
      background: #f8fafc;
    }

    .poll-option input[type="radio"] {
      margin-right: 1rem;
      transform: scale(1.2);
    }

    .poll-submit {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .poll-submit:hover {
      transform: translateY(-2px);
    }

    .poll-results {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f8fafc;
      border-radius: 10px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 2.5rem;
      }
      
      .tools-grid {
        grid-template-columns: 1fr;
      }
      
      .sketches-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
      
      .nav-links {
        display: none;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.6s ease-out;
    }

    /* Loading States */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--text-secondary);
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-top: 2px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <!-- Hero Header -->
  <header class="hero-header">
                    <div class="hero-content">
                  <h1 class="hero-title">Computational Design Workflows</h1>
                </div>
  </header>

  <!-- Navigation -->
  <nav class="nav-container">
    <div class="nav-content">
      <div class="nav-logo">CDP Portfolio</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="colloquium1.html">Colloquium 1</a></li>
        <li><a href="mapping.html">Mapping Systems</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-container">
    <!-- Tools Overview -->
    <section class="content-section fade-in-up">
      <div class="section-header">
        <h2 class="section-title">Design Workflow Tools</h2>
        <p class="section-subtitle">Explore the computational design tools and technologies used in this project. Click each components and scroll down to see the work.</p>
      </div>
      
      <div class="tools-grid">
                            <div class="tool-card" onclick="showToolContent('p5js')">
                      <div class="tool-icon">üé®</div>
                      <h3 class="tool-title">p5.js</h3>
                      <p class="tool-description">Exploring Gradient artboards that changes the color every time, click refreshing the page. Playing with HSB to play with the saturation and brightness of colors. Artworks inspired by Zack Lieberman.</p>
                    </div>

                  <div class="tool-card" onclick="showToolContent('threejs')">
            <div class="tool-icon">üåê</div>
            <h3 class="tool-title">Three.js</h3>
            <p class="tool-description">Extension of p5.js</p>
          </div>

                  <div class="tool-card" onclick="showToolContent('d3js')">
            <div class="tool-icon">üìä</div>
            <h3 class="tool-title">D3.js</h3>
            <p class="tool-description">Exploring my favorite contemporary Artists to see their active years in their art movements. And finding the relations to see if they had any exhibition together.</p>
          </div>

                  <div class="tool-card" onclick="showToolContent('mapping')">
            <div class="tool-icon">üó∫Ô∏è</div>
            <h3 class="tool-title">Mapbox</h3>
            <p class="tool-description">Interactive mapping to explore what is near my house and finding the pattern throughout my routine.</p>
          </div>

                  <div class="tool-card" onclick="showToolContent('firebasepoll')">
            <div class="tool-icon">üî•</div>
            <h3 class="tool-title">Firebase</h3>
            <p class="tool-description">Creating a poll using a backend API using Firebase.</p>
          </div>
      </div>
    </section>

    <!-- Tool Content Sections -->
    <div id="p5js-content" class="content-section tool-content" style="display: none;">
      <div class="section-header">
        <h2 class="section-title">p5.js: Creative Coding</h2>
        <p class="section-subtitle">Interactive generative art and creative coding experiments</p>
      </div>
      
      <div class="sketches-grid">
        <div class="sketch-container">
          <div id="p5sketch1" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 1</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch2" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 2</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch3" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 3</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch4" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 4</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch5" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 5</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch6" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 6</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch7" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 7</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch8" class="sketch-canvas"></div>
          <div class="sketch-title">Random Gradient 8</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch9" class="sketch-canvas"></div>
          <div class="sketch-title">3D Animated Object 1</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch10" class="sketch-canvas"></div>
          <div class="sketch-title">3D Animated Object 2</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch11" class="sketch-canvas"></div>
          <div class="sketch-title">3D Animated Object 3</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch12" class="sketch-canvas"></div>
          <div class="sketch-title">3D Animated Object 4</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch13" class="sketch-canvas"></div>
          <div class="sketch-title">HSB 3D Layers 1</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch14" class="sketch-canvas"></div>
          <div class="sketch-title">HSB 3D Layers 2</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch15" class="sketch-canvas"></div>
          <div class="sketch-title">HSB 3D Layers 3</div>
        </div>
        <div class="sketch-container">
          <div id="p5sketch16" class="sketch-canvas"></div>
          <div class="sketch-title">HSB 3D Layers 4</div>
        </div>
      </div>
    </div>

    <div id="threejs-content" class="content-section tool-content" style="display: none;">
      <div class="section-header">
        <h2 class="section-title">Three.js: 3D Graphics</h2>
        <p class="section-subtitle">Interactive 3D scenes and WebGL-powered graphics</p>
      </div>
      
      <div class="sketches-grid">
        <div class="sketch-container">
          <div id="threejs-canvas1" class="sketch-canvas"></div>
          <div class="sketch-title">Three.js Scene 1</div>
        </div>
        <div class="sketch-container">
          <div id="threejs-canvas2" class="sketch-canvas"></div>
          <div class="sketch-title">Three.js Scene 2</div>
        </div>
        <div class="sketch-container">
          <div id="threejs-canvas3" class="sketch-canvas"></div>
          <div class="sketch-title">Three.js Scene 3</div>
        </div>
      </div>
    </div>

    <div id="d3js-content" class="content-section tool-content" style="display: none;">
      <div class="section-header">
        <h2 class="section-title">D3.js: Data Visualization</h2>
      </div>
      
      <div id="timeline-chart"></div>
      <div id="relational-graph"></div>
    </div>

    <div id="mapping-content" class="content-section tool-content" style="display: none;">
      <div class="section-header">
        <h2 class="section-title">Mapping: Spatial Analysis</h2>
        <p class="section-subtitle">Interactive maps and geospatial data visualization</p>
      </div>
      
      <div class="map-container">
        <div class="map-controls">
          <div class="search-container">
            <input type="text" id="neighborhood-search" class="search-input" placeholder="Search neighborhoods...">
            <button id="search-btn" class="search-btn">Search</button>
          </div>
        </div>
        <div id="map" style="width: 100%; height: 500px;"></div>
      </div>

      <div class="map-container">
        <div class="map-controls">
          <button id="reset-view" class="search-btn">Reset View</button>
        </div>
        <div id="advanced-map" style="width: 100%; height: 600px;"></div>
      </div>

      <div class="map-container">
        <div class="map-controls">
          <h3 style="margin: 0; color: var(--text-primary);">My Daily Routine</h3>
        </div>
        <div id="routine-map" style="width: 100%; height: 500px;"></div>
      </div>
    </div>

    <div id="firebasepoll-content" class="content-section tool-content" style="display: none;">
      <div class="section-header">
        <h2 class="section-title">Firebase: Real-time Polling</h2>
        <p class="section-subtitle">Interactive polling system with live data synchronization</p>
      </div>
      
      <div class="poll-section">
        <h3 class="poll-question">Can I be your favorite person?</h3>
        <form id="poll-form-firebase" class="poll-options">
          <label class="poll-option">
            <input type="radio" name="student" value="Yes" id="yes-firebase">
            <span>Yes</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="student" value="No" id="no-firebase">
            <span>No</span>
          </label>
          <button type="submit" class="poll-submit">Vote</button>
        </form>
        <div id="poll-results-firebase" class="poll-results"></div>
      </div>

      <div class="poll-section">
        <h3 class="poll-question">How are you doing?</h3>
        <form id="howareyou-form-firebase" class="poll-options">
          <label class="poll-option">
            <input type="radio" name="howareyou" value="Good" id="good-firebase">
            <span>Good</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="howareyou" value="Okay" id="okay-firebase">
            <span>Okay</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="howareyou" value="Tired" id="tired-firebase">
            <span>Tired</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="howareyou" value="Others" id="others-firebase">
            <span>Others</span>
          </label>
          <button type="submit" class="poll-submit">Vote</button>
        </form>
        <div id="howareyou-results-firebase" class="poll-results"></div>
      </div>

      <div class="poll-section">
        <h3 class="poll-question">What motivates you the most?</h3>
        <form id="motivation-form-firebase" class="poll-options">
          <label class="poll-option">
            <input type="radio" name="motivation" value="Personal Passion" id="motivation-passion">
            <span>Personal Passion</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="motivation" value="Financial Reward" id="motivation-financial">
            <span>Financial Reward</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="motivation" value="Public Recognition" id="motivation-recognition">
            <span>Public Recognition</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="motivation" value="Collaboration with Others" id="motivation-collaboration">
            <span>Collaboration with Others</span>
          </label>
          <button type="submit" class="poll-submit">Vote</button>
        </form>
        <div id="motivation-results-firebase" class="poll-results"></div>
      </div>

      <div class="poll-section">
        <h3 class="poll-question">Which method of data collection do you trust the most?</h3>
        <form id="datatrust-form-firebase" class="poll-options">
          <label class="poll-option">
            <input type="radio" name="datatrust" value="Surveys" id="datatrust-surveys">
            <span>Surveys</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="datatrust" value="Interviews" id="datatrust-interviews">
            <span>Interviews</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="datatrust" value="Observations" id="datatrust-observations">
            <span>Observations</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="datatrust" value="Sensor/IoT Data" id="datatrust-sensor">
            <span>Sensor/IoT Data</span>
          </label>
          <label class="poll-option">
            <input type="radio" name="datatrust" value="Web & App Analytics" id="datatrust-analytics">
            <span>Web & App Analytics</span>
          </label>
          <button type="submit" class="poll-submit">Vote</button>
        </form>
        <div id="datatrust-results-firebase" class="poll-results"></div>
      </div>
    </div>
  </main>



  <!-- Include all the JavaScript from the original file -->
  <script>
    // Tool content navigation
    function showToolContent(toolName) {
      // Hide all tool content sections
      const allToolContent = document.querySelectorAll('.tool-content');
      allToolContent.forEach(content => {
        content.style.display = 'none';
      });
      
      // Show the selected tool content
      const selectedContent = document.getElementById(toolName + '-content');
      if (selectedContent) {
        selectedContent.style.display = 'block';
        selectedContent.classList.add('fade-in-up');
      }
    }

    // Add smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });

    // Add intersection observer for animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('fade-in-up');
        }
      });
    }, observerOptions);

    // Observe all content sections
    document.querySelectorAll('.content-section').forEach(section => {
      observer.observe(section);
    });
  </script>

  <!-- D3.js and p5.js Functionality -->
  <script>
    // ============================================================================
    // INITIALIZATION
    // ============================================================================
    
    document.addEventListener('DOMContentLoaded', function() {
      loadArtistTimeline();
    });
    

    
    // ============================================================================
    // DATA LOADING
    // ============================================================================
    
    function loadArtistTimeline() {
      d3.csv('temporal.csv')
        .then(function(data) {
          console.log('Loaded artist data:', data);
          createTimelineVisualization(data);
        })
        .catch(function(error) {
          console.error('Error loading CSV:', error);
        });
    }
    
    // ============================================================================
    // CHART CREATION
    // ============================================================================
    
    function createTimelineVisualization(data) {
      // Chart dimensions and margins - increased for better fit
      const margin = {top: 40, right: 40, bottom: 80, left: 180};
      const width = 1200 - margin.left - margin.right;
      const height = 600 - margin.top - margin.bottom;
      
      // Clear existing content
      d3.select("#timeline-chart").html("");
      
      // Create SVG container
      const svg = d3.select("#timeline-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);
      
      // Create scales
      const scales = createScales(data, width, height);
      
      // Add chart elements
      addAxes(svg, scales, height);
      addTimelineBars(svg, data, scales);
      addChartLabels(svg, width, height);
      

    }
    
    // ============================================================================
    // SCALE CREATION
    // ============================================================================
    
    function createScales(data, width, height) {
      // Time scale (X-axis)
      const timeExtent = d3.extent(data, d => [+d.start, +d.end]).flat();
      const xScale = d3.scaleLinear()
        .domain([d3.min(timeExtent), d3.max(timeExtent)])
        .range([0, width]);
      
      // Artist names scale (Y-axis)
      const yScale = d3.scaleBand()
        .domain(data.map(d => d.name))
        .range([0, height])
        .padding(0.1);
      
      // Color scale for categories
      const categories = [...new Set(data.map(d => d.category))];
      const colorScale = d3.scaleOrdinal()
        .domain(categories)
        .range(d3.schemeCategory10);
      
      return { xScale, yScale, colorScale, categories };
    }
    
    // ============================================================================
    // CHART ELEMENTS
    // ============================================================================
    
    function addAxes(svg, scales, height) {
      // X-axis (timeline)
      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(scales.xScale).tickFormat(d3.format("d")).ticks(10))
        .selectAll("text")
        .style("text-anchor", "middle")
        .style("font-size", "12px");
      
      // Y-axis (artist names)
      svg.append("g")
        .call(d3.axisLeft(scales.yScale))
        .selectAll("text")
        .style("text-anchor", "end")
        .style("font-size", "12px")
        .attr("dx", "-0.8em")
        .attr("dy", "0.35em")
        .style("cursor", "pointer");
    }
    
    function addTimelineBars(svg, data, scales) {
      svg.selectAll(".artist-bar")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "artist-bar")
        .attr("x", d => scales.xScale(+d.start))
        .attr("y", d => scales.yScale(d.name))
        .attr("width", d => scales.xScale(+d.end) - scales.xScale(+d.start))
        .attr("height", scales.yScale.bandwidth())
        .attr("fill", d => scales.colorScale(d.category))
        .attr("stroke", "#333")
        .attr("stroke-width", 1)
        .on("mouseover", function(event, d) {
          showTooltip(event, d);
        })
        .on("mouseout", function() {
          hideTooltip();
        });
    }
    
    function addChartLabels(svg, width, height) {
      // Chart title
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", -15)
        .attr("text-anchor", "middle")
        .style("font-size", "18px")
        .style("font-weight", "bold")
        .text("Artist Timeline Analysis (1968-2025)");
      
      // X-axis label
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height + 40)
        .attr("text-anchor", "middle")
        .style("font-size", "14px")
        .text("Year");
    }
    
    // ============================================================================
    // INTERACTIVITY
    // ============================================================================
    
    function showTooltip(event, data) {
      const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 10) + "px");
      
      tooltip.html(`
        <strong>${data.name}</strong><br/>
        Period: ${data.start} - ${data.end}<br/>
        Category: ${data.category}<br/>
        Duration: ${+data.end - +data.start} years
      `);
    }
    
    function hideTooltip() {
      d3.selectAll(".tooltip").remove();
    }
    

    

  </script>

  <!-- p5.js Sketches -->
  <script>
    // Sketch 1
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch1');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        // Pick 4 random corner colors
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });

    // Sketch 2
    new p5(function(p) {
      let cols, rows;
      let pixelSize = 40;
      let c1, c2, c3, c4;
      
      p.setup = function() {
        let canvas = p.createCanvas(280, 280);
        canvas.parent('p5sketch2');
        p.noStroke();
        cols = p.width / pixelSize;
        rows = p.height / pixelSize;
        
        c1 = p.color(p.random(255), p.random(255), p.random(255));
        c2 = p.color(p.random(255), p.random(255), p.random(255));
        c3 = p.color(p.random(255), p.random(255), p.random(255));
        c4 = p.color(p.random(255), p.random(255), p.random(255));
        
        drawRandomGradient();
      };
      
      p.draw = function() {
        // nothing here
      };
      
      function drawRandomGradient() {
        for (let y = 0; y < rows; y++) {
          let ty = y / rows;
          for (let x = 0; x < cols; x++) {
            let tx = x / cols;
            
            let top = p.lerpColor(c1, c2, tx);
            let bottom = p.lerpColor(c3, c4, tx);
            let baseColor = p.lerpColor(top, bottom, ty);
            
            let r = p.red(baseColor) + p.random(-20, 20);
            let g = p.green(baseColor) + p.random(-20, 20);
            let b = p.blue(baseColor) + p.random(-20, 20);
            
            p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
            p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }
    });

    // Add more sketches (3-16) with similar pattern...
    // For brevity, I'll add a few more key ones
    for (let i = 3; i <= 8; i++) {
      new p5(function(p) {
        let cols, rows;
        let pixelSize = 40;
        let c1, c2, c3, c4;
        
        p.setup = function() {
          let canvas = p.createCanvas(280, 280);
          canvas.parent('p5sketch' + i);
          p.noStroke();
          cols = p.width / pixelSize;
          rows = p.height / pixelSize;
          
          c1 = p.color(p.random(255), p.random(255), p.random(255));
          c2 = p.color(p.random(255), p.random(255), p.random(255));
          c3 = p.color(p.random(255), p.random(255), p.random(255));
          c4 = p.color(p.random(255), p.random(255), p.random(255));
          
          drawRandomGradient();
        };
        
        p.draw = function() {
          // nothing here
        };
        
        function drawRandomGradient() {
          for (let y = 0; y < rows; y++) {
            let ty = y / rows;
            for (let x = 0; x < cols; x++) {
              let tx = x / cols;
              
              let top = p.lerpColor(c1, c2, tx);
              let bottom = p.lerpColor(c3, c4, tx);
              let baseColor = p.lerpColor(top, bottom, ty);
              
              let r = p.red(baseColor) + p.random(-20, 20);
              let g = p.green(baseColor) + p.random(-20, 20);
              let b = p.blue(baseColor) + p.random(-20, 20);
              
              p.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
              p.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
            }
          }
        }
      });
    }

    // 3D Animated Objects (sketches 9-12)
    for (let i = 9; i <= 12; i++) {
      new p5(function(p) {
        let pixelBackground;
        let pixelSize = 40;
        let cols, rows;
        let c1, c2, c3, c4;
        
        p.setup = function() {
          let canvas = p.createCanvas(280, 280, p.WEBGL);
          canvas.parent('p5sketch' + i);
          p.angleMode(p.DEGREES);

          pixelBackground = p.createGraphics(280, 280, p.P2D);
          cols = 280 / pixelSize;
          rows = 280 / pixelSize;

          c1 = p.color(p.random(255), p.random(255), p.random(255));
          c2 = p.color(p.random(255), p.random(255), p.random(255));
          c3 = p.color(p.random(255), p.random(255), p.random(255));
          c4 = p.color(p.random(255), p.random(255), p.random(255));
        };
        
        p.draw = function() {
          drawRandomGradient(pixelBackground);

          p.push();
          p.resetMatrix();
          p.translate(-140, -140, -500);
          p.texture(pixelBackground);
          p.noStroke();
          p.beginShape();
          p.vertex(0, 0, 0, 0);
          p.vertex(280, 0, 1, 0);
          p.vertex(280, 280, 1, 1);
          p.vertex(0, 280, 0, 1);
          p.endShape(p.CLOSE);
          p.pop();

          p.noFill();
          p.stroke(255);

          let x = p.sin(p.frameCount * 2) * 30;
          let y = p.cos(p.frameCount) * 30;
          let z = p.sin(p.frameCount * 4) * 30;

          p.translate(x, y, z);
          p.rotateX(p.frameCount);
          p.rotateY(p.frameCount / 2);
          p.rotateZ(p.frameCount / 4);

          for (let j = 0; j < 360; j += 10) {
            p.push();
            let r = p.map(p.sin(j + p.frameCount), -1, 1, 200, 50);
            let g = p.map(p.sin(j + p.frameCount / 3), -1, 1, 50, 200);
            let b = p.map(p.cos(j + p.frameCount / 7), -1, 1, 50, 200);

            p.stroke(r, g, b);
            p.rotateY(j / 2);
            p.ellipse(0, 0, 120);
            p.pop();
          }
        };
        
        function drawRandomGradient(gfx) {
          for (let y = 0; y < rows; y++) {
            let ty = y / rows;
            for (let x = 0; x < cols; x++) {
              let tx = x / cols;

              let top = p.lerpColor(c1, c2, tx);
              let bottom = p.lerpColor(c3, c4, tx);
              let baseColor = p.lerpColor(top, bottom, ty);

              let r = p.red(baseColor) + p.random(-20, 20);
              let g = p.green(baseColor) + p.random(-20, 20);
              let b = p.blue(baseColor) + p.random(-20, 20);

              gfx.noStroke();
              gfx.fill(p.constrain(r, 0, 255), p.constrain(g, 0, 255), p.constrain(b, 0, 255));
              gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
            }
          }
        }
      });
    }

    // HSB 3D Layers (sketches 13-16)
    for (let i = 13; i <= 16; i++) {
      new p5(function(p) {
        let pixelBackground;
        let pixelSize = 20;
        let cols, rows;
        let c1, c2, c3, c4;
        
        p.setup = function() {
          let canvas = p.createCanvas(280, 280, p.WEBGL);
          canvas.parent('p5sketch' + i);
          p.angleMode(p.DEGREES);
          p.colorMode(p.HSB, 360, 100, 100, 100);
          p.noFill();

          pixelBackground = p.createGraphics(280, 280, p.P2D);
          pixelBackground.colorMode(p.HSB, 360, 100, 100, 100);

          cols = 280 / pixelSize;
          rows = 280 / pixelSize;
        };
        
        p.draw = function() {
          c1 = p.color(p.random(360), 80, 80);
          c2 = p.color(p.random(360), 80, 80);
          c3 = p.color(p.random(360), 80, 80);
          c4 = p.color(p.random(360), 80, 80);
          
          drawPixelatedGradient(pixelBackground);

          p.push();
          p.resetMatrix();
          p.translate(-140, -140, -500);
          p.texture(pixelBackground);
          p.noStroke();
          p.beginShape();
          p.vertex(0, 0, 0, 0);
          p.vertex(280, 0, 1, 0);
          p.vertex(280, 280, 1, 1);
          p.vertex(0, 280, 0, 1);
          p.endShape(p.CLOSE);
          p.pop();

          p.rotateY(p.frameCount * 0.3);
          p.rotateX(p.frameCount * 0.2);
          p.strokeWeight(1.2);

          for (let j = 0; j < 5; j++) {
            p.push();
            let zOffset = p.map(j, 0, 5, -100, 100);
            p.translate(0, 0, zOffset);

            for (let k = 0; k < 360; k += 10) {
              p.push();

              let hue = (k * 2 + p.frameCount * 2 + j * 30) % 360;
              let sat = p.map(p.sin(k + p.frameCount / 3), -1, 1, 60, 100);
              let bri = p.map(p.cos(k + p.frameCount / 5), -1, 1, 60, 100);
              p.stroke(hue, sat, bri, 80);

              p.rotateY(k + p.frameCount);
              let radius = 100 + p.sin(p.frameCount + j * 30) * 40;
              p.ellipse(0, 0, radius, radius / 2);

              p.pop();
            }
            p.pop();
          }
        };
        
        function drawPixelatedGradient(gfx) {
          for (let y = 0; y < rows; y++) {
            let ty = y / rows;
            for (let x = 0; x < cols; x++) {
              let tx = x / cols;

              let top = p.lerpColor(c1, c2, tx);
              let bottom = p.lerpColor(c3, c4, tx);
              let baseColor = p.lerpColor(top, bottom, ty);

              let h = p.hue(baseColor) + p.random(-5, 5);
              let s = p.saturation(baseColor) + p.random(-10, 10);
              let b = p.brightness(baseColor) + p.random(-10, 10);

              gfx.noStroke();
              gfx.fill((h + 360) % 360, p.constrain(s, 0, 100), p.constrain(b, 0, 100));
              gfx.rect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
            }
          }
        }
      });
    }
  </script>

  <!-- Relational Graph -->
  <script>
    d3.csv("relational_fixed.csv").then(function(linksRaw) {
      const groupMap = {};
      const nodeMap = new Map();
    
      linksRaw.forEach(d => {
        const name = d.name.trim();
        const category = d.category.trim();
        let key = "";
    
        if (category === "education") {
          key = d.education.trim();
          nodeMap.set(key, { id: key, type: "education" });
        } else if (category === "nationality") {
          key = d.nationality.trim();
          nodeMap.set(key, { id: key, type: "nationality" });
        } else if (category === "gallery") {
          key = d.education.trim();
          nodeMap.set(key, { id: key, type: "gallery" });
        } else if (category === "exhibition_country") {
          key = d.nationality.trim();
          nodeMap.set(key, { id: key, type: "exhibition_country" });
        }
    
        if (!groupMap[key]) groupMap[key] = [];
        groupMap[key].push(name);
    
        if (!nodeMap.has(name)) {
          nodeMap.set(name, { id: name, type: "artist" });
        }
      });
    
      const links = [];
      Object.entries(groupMap).forEach(([key, members]) => {
        for (let i = 0; i < members.length; i++) {
          links.push({ source: members[i], target: key, type: nodeMap.get(key).type });
        }
      });
    
      const nodes = Array.from(nodeMap.values());
    
      const colorScale = {
        artist: "#1f77b4",
        education: "#2ca02c",
        gallery: "#ff7f0e",
        nationality: "#9467bd",
        exhibition_country: "#e377c2"
      };
    
      const radiusScale = {
        artist: 18,
        education: 14,
        gallery: 14,
        nationality: 14,
        exhibition_country: 14
      };
    
      const width = 1200, height = 700;
      const svg = d3.select("#relational-graph")
        .html("")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "#fafbfc")
        .style("border-radius", "10px");
    
      const zoomGroup = svg.append("g");
      svg.call(
        d3.zoom()
          .scaleExtent([0.5, 4])
          .on("zoom", event => zoomGroup.attr("transform", event.transform))
      );
    
      const simulation = d3.forceSimulation(nodes)
        .force("link", d3.forceLink(links).id(d => d.id).distance(100))
        .force("charge", d3.forceManyBody().strength(-300))
        .force("center", d3.forceCenter(width / 2, height / 2));
    
      const link = zoomGroup.append("g")
        .selectAll("line")
        .data(links)
        .join("line")
        .attr("stroke-width", 1.5)
        .attr("stroke", d => colorScale[d.type] || "#ccc")
        .attr("stroke-opacity", 0.6);
    
      const node = zoomGroup.append("g")
        .selectAll("g")
        .data(nodes)
        .join("g")
        .attr("class", "node")
        .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended)
        );
    
      node.append("circle")
        .attr("r", d => radiusScale[d.type] || 10)
        .attr("fill", d => colorScale[d.type] || "#ccc")
        .attr("stroke", "#333")
        .attr("stroke-width", 1.5);
    
      node.append("text")
        .attr("dy", 4)
        .attr("x", d => radiusScale[d.type] + 4)
        .style("font-size", "11px")
        .style("pointer-events", "none")
        .text(d => d.id);
    
      const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0)
        .style("position", "absolute")
        .style("padding", "6px 10px")
        .style("background", "#fff")
        .style("border", "1px solid #ccc")
        .style("border-radius", "4px")
        .style("pointer-events", "none")
        .style("font-size", "12px");
    
      const labelMap = {
        artist: "Artist",
        education: "Education (School)",
        gallery: "Gallery",
        nationality: "Nationality",
        exhibition_country: "Exhibition Country"
      };
    
      node.on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 1);
        tooltip.html(`<strong>${d.id}</strong><br><span style="color:#666">${labelMap[d.type] || "Unknown"}</span>`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 20) + "px");
    
        node.selectAll("circle").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
        node.selectAll("text").transition().duration(200).style("opacity", o => o.id === d.id || links.some(l => (l.source.id === d.id && l.target.id === o.id) || (l.target.id === d.id && l.source.id === o.id)) ? 1 : 0.1);
        link.transition().duration(200).style("opacity", l => l.source.id === d.id || l.target.id === d.id ? 1 : 0.05);
      }).on("mouseout", function() {
        tooltip.transition().duration(200).style("opacity", 0);
        node.selectAll("circle").transition().duration(200).style("opacity", 1);
        node.selectAll("text").transition().duration(200).style("opacity", 1);
        link.transition().duration(200).style("opacity", 0.6);
      });
    
      simulation.on("tick", () => {
        link
          .attr("x1", d => d.source.x)
          .attr("y1", d => d.source.y)
          .attr("x2", d => d.target.x)
          .attr("y2", d => d.target.y);
    
        node.attr("transform", d => {
          d.x = Math.max(20, Math.min(width - 20, d.x));
          d.y = Math.max(20, Math.min(height - 20, d.y));
          return `translate(${d.x},${d.y})`;
        });
      });
    
      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }
      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }
      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }
    
      const legendData = Object.entries(colorScale).map(([type, color]) => ({
        label: labelMap[type],
        color
      }));
    
      const legend = svg.append("g")
        .attr("transform", `translate(${width - 220}, 20)`);
    
      legend.selectAll("rect")
        .data(legendData)
        .join("rect")
        .attr("x", 0)
        .attr("y", (d, i) => i * 22)
        .attr("width", 14)
        .attr("height", 14)
        .attr("fill", d => d.color);
    
      legend.selectAll("text")
        .data(legendData)
        .join("text")
        .attr("x", 20)
        .attr("y", (d, i) => i * 22 + 11)
        .style("font-size", "13px")
        .style("fill", "#333")
        .text(d => d.label);
    });
  </script>

  <!-- Firebase SDK and poll logic -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyATihgXVJqhja1rZPE0rL06y83MR5fS-dc",
      authDomain: "poll-tutorial-6726b.firebaseapp.com",
      projectId: "poll-tutorial-6726b",
      storageBucket: "poll-tutorial-6726b.firebasestorage.app",
      messagingSenderId: "1013845591191",
      appId: "1:1013845591191:web:6325973ef3ea5f3dde55d2",
      measurementId: "G-E6WHNL5TPR"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Poll 1 logic
    const pollForm = document.getElementById('poll-form-firebase');
    const pollResults = document.getElementById('poll-results-firebase');
    pollForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const answer = document.querySelector('input[name="student"]:checked');
      if (!answer) {
        alert('Please select an option.');
        return;
      }
      await db.collection('studentPoll').add({ answer: answer.value });
      pollForm.reset();
    });
    
    function renderResults(counts) {
      pollResults.innerHTML = `
        <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
        <ul style='list-style:none; padding:0;'>
          <li style='margin-bottom:6px;'>Yes: <strong>${counts['Yes']}</strong></li>
          <li>No: <strong>${counts['No']}</strong></li>
        </ul>
      `;
    }
    
    db.collection('studentPoll').onSnapshot(function(snapshot) {
      const counts = { 'Yes': 0, 'No': 0 };
      snapshot.forEach(function(doc) {
        const answer = doc.data().answer;
        if (counts[answer] !== undefined) counts[answer]++;
      });
      renderResults(counts);
    });

    // Poll 2 logic
    const howAreYouForm = document.getElementById('howareyou-form-firebase');
    const howAreYouResults = document.getElementById('howareyou-results-firebase');
    howAreYouForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const answer = document.querySelector('input[name="howareyou"]:checked');
      if (!answer) {
        alert('Please select an option.');
        return;
      }
      await db.collection('howAreYouPoll').add({ answer: answer.value });
      howAreYouForm.reset();
    });
    
    function renderHowAreYouResults(counts) {
      howAreYouResults.innerHTML = `
        <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
        <ul style='list-style:none; padding:0;'>
          <li style='margin-bottom:6px;'>Good: <strong>${counts['Good']}</strong></li>
          <li style='margin-bottom:6px;'>Okay: <strong>${counts['Okay']}</strong></li>
          <li style='margin-bottom:6px;'>Tired: <strong>${counts['Tired']}</strong></li>
          <li>Others: <strong>${counts['Others']}</strong></li>
        </ul>
      `;
    }
    
    db.collection('howAreYouPoll').onSnapshot(function(snapshot) {
      const counts = { 'Good': 0, 'Okay': 0, 'Tired': 0, 'Others': 0 };
      snapshot.forEach(function(doc) {
        const answer = doc.data().answer;
        if (counts[answer] !== undefined) counts[answer]++;
      });
      renderHowAreYouResults(counts);
    });

    // Poll 3 logic
    const motivationForm = document.getElementById('motivation-form-firebase');
    const motivationResults = document.getElementById('motivation-results-firebase');
    motivationForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const motivation = document.querySelector('input[name="motivation"]:checked');
      if (!motivation) {
        alert('Please select an option.');
        return;
      }
      await db.collection('motivationPoll').add({ answer: motivation.value });
      motivationForm.reset();
    });
    
    function renderMotivationResults(counts) {
      motivationResults.innerHTML = `
        <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
        <ul style='list-style:none; padding:0;'>
          <li style='margin-bottom:6px;'>Personal Passion: <strong>${counts['Personal Passion']}</strong></li>
          <li style='margin-bottom:6px;'>Financial Reward: <strong>${counts['Financial Reward']}</strong></li>
          <li style='margin-bottom:6px;'>Public Recognition: <strong>${counts['Public Recognition']}</strong></li>
          <li style='margin-bottom:6px;'>Collaboration with Others: <strong>${counts['Collaboration with Others']}</strong></li>
        </ul>
      `;
    }
    
    db.collection('motivationPoll').onSnapshot(function(snapshot) {
      const counts = { 'Personal Passion': 0, 'Financial Reward': 0, 'Public Recognition': 0, 'Collaboration with Others': 0 };
      snapshot.forEach(function(doc) {
        const answer = doc.data().answer;
        if (counts[answer] !== undefined) counts[answer]++;
      });
      renderMotivationResults(counts);
    });

    // Poll 4 logic
    const datatrustForm = document.getElementById('datatrust-form-firebase');
    const datatrustResults = document.getElementById('datatrust-results-firebase');
    datatrustForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const datatrust = document.querySelector('input[name="datatrust"]:checked');
      if (!datatrust) {
        alert('Please select an option.');
        return;
      }
      await db.collection('dataTrustPoll').add({ answer: datatrust.value });
      datatrustForm.reset();
    });
    
    function renderDatatrustResults(counts) {
      datatrustResults.innerHTML = `
        <h4 style='font-size:1.1rem; margin-bottom:8px;'>Live Results:</h4>
        <ul style='list-style:none; padding:0;'>
          <li style='margin-bottom:6px;'>Surveys: <strong>${counts['Surveys']}</strong></li>
          <li style='margin-bottom:6px;'>Interviews: <strong>${counts['Interviews']}</strong></li>
          <li style='margin-bottom:6px;'>Observations: <strong>${counts['Observations']}</strong></li>
          <li style='margin-bottom:6px;'>Sensor/IoT Data: <strong>${counts['Sensor/IoT Data']}</strong></li>
          <li style='margin-bottom:6px;'>Web & App Analytics: <strong>${counts['Web & App Analytics']}</strong></li>
        </ul>
      `;
    }
    
    db.collection('dataTrustPoll').onSnapshot(function(snapshot) {
      const counts = { 'Surveys': 0, 'Interviews': 0, 'Observations': 0, 'Sensor/IoT Data': 0, 'Web & App Analytics': 0 };
      snapshot.forEach(function(doc) {
        const answer = doc.data().answer;
        if (counts[answer] !== undefined) counts[answer]++;
      });
      renderDatatrustResults(counts);
    });
  </script>

  <!-- Three.js Library and Scenes -->
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js';
    
    // Three.js Scene 1
    let scene1, camera1, renderer1;
    let rings1 = [];
    let time1 = 0;

    function initThreeJS1() {
      const container = document.getElementById('threejs-canvas1');
      if (!container) return;

      scene1 = new THREE.Scene();
      camera1 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera1.position.z = 200;

      renderer1 = new THREE.WebGLRenderer({ antialias: true });
      renderer1.setSize(380, 380);
      container.appendChild(renderer1.domElement);

      // Pixelated Gradient Background Plane
      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false,
        transparent: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene1.add(bgMesh);

      // Add rings
      const ringCount = 5;
      for (let j = 0; j < ringCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const radius = 50 + j * 10;
          const geo = new THREE.TorusGeometry(radius, 1.5, 8, 64);
          const mat = new THREE.MeshBasicMaterial({ color: new THREE.Color(`hsl(${(i * 2 + j * 30) % 360}, 100%, 60%)`) });
          const mesh = new THREE.Mesh(geo, mat);
          mesh.rotation.y = THREE.MathUtils.degToRad(i);
          group.add(mesh);
        }

        group.position.z = -50 + j * 25;
        rings1.push(group);
        scene1.add(group);
      }

      animate1();
    }

    function animate1() {
      requestAnimationFrame(animate1);
      time1 += 1;

      if (scene1 && scene1.children[0]) {
        scene1.children[0].material.uniforms.time.value = time1;
      }

      rings1.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time1 * 0.5 + j * 30) % 360;
          mesh.material.color.setHSL(hue / 360, 1, 0.6);
        });
      });

      if (renderer1 && scene1 && camera1) {
        renderer1.render(scene1, camera1);
      }
    }

    // Three.js Scene 2
    let scene2, camera2, renderer2;
    let ellipseGroups2 = [];
    let time2 = 0;

    function initThreeJS2() {
      const container = document.getElementById('threejs-canvas2');
      if (!container) return;

      scene2 = new THREE.Scene();
      camera2 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera2.position.z = 200;

      renderer2 = new THREE.WebGLRenderer({ antialias: true });
      renderer2.setSize(380, 380);
      container.appendChild(renderer2.domElement);

      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene2.add(bgMesh);

      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.CircleGeometry(1, 64);
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.8, side: THREE.DoubleSide });
          const ellipse = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          ellipse.position.x = Math.cos(angle) * radius;
          ellipse.position.y = Math.sin(angle) * radius;
          ellipse.position.z = -50 + j * 25;

          ellipse.scale.set(10, 5, 1);

          group.add(ellipse);
        }

        ellipseGroups2.push(group);
        scene2.add(group);
      }

      animate2();
    }

    function animate2() {
      requestAnimationFrame(animate2);
      time2 += 1;

      if (scene2 && scene2.children[0]) {
        scene2.children[0].material.uniforms.time.value = time2;
      }

      ellipseGroups2.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time2 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer2 && scene2 && camera2) {
        renderer2.render(scene2, camera2);
      }
    }

    // Three.js Scene 3
    let scene3, camera3, renderer3;
    let rectangleGroups3 = [];
    let time3 = 0;

    function initThreeJS3() {
      const container = document.getElementById('threejs-canvas3');
      if (!container) return;

      scene3 = new THREE.Scene();
      camera3 = new THREE.PerspectiveCamera(60, 380 / 380, 0.1, 1000);
      camera3.position.z = 200;

      renderer3 = new THREE.WebGLRenderer({ antialias: true });
      renderer3.setSize(380, 380);
      container.appendChild(renderer3.domElement);

      const bgGeometry = new THREE.PlaneGeometry(2, 2);
      const bgMaterial = new THREE.ShaderMaterial({
        uniforms: {
          time: { value: 0 },
          resolution: { value: new THREE.Vector2(380, 380) }
        },
        vertexShader: `
          void main() {
            gl_Position = vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float time;
          uniform vec2 resolution;

          float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
          }

          void main() {
            vec2 st = gl_FragCoord.xy / resolution.xy;
            float pixelSize = 0.04;

            st = floor(st / pixelSize) * pixelSize;

            vec3 color1 = vec3(1.0, 0.5, 0.5);
            vec3 color2 = vec3(0.5, 0.8, 1.0);
            vec3 color3 = vec3(0.7, 1.0, 0.6);
            vec3 color4 = vec3(1.0, 0.9, 0.3);

            vec3 top = mix(color1, color2, st.x);
            vec3 bottom = mix(color3, color4, st.x);
            vec3 base = mix(top, bottom, st.y);

            float noise = random(st + time * 0.05) * 0.2;
            base += noise;

            gl_FragColor = vec4(base, 1.0);
          }
        `,
        depthWrite: false,
        depthTest: false
      });

      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.frustumCulled = false;
      scene3.add(bgMesh);

      const groupCount = 5;
      for (let j = 0; j < groupCount; j++) {
        const group = new THREE.Group();

        for (let i = 0; i < 360; i += 10) {
          const geometry = new THREE.PlaneGeometry(8, 20);
          const material = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.9 });
          const rect = new THREE.Mesh(geometry, material);

          const angle = THREE.MathUtils.degToRad(i);
          const radius = 60 + j * 10;

          rect.position.x = Math.cos(angle) * radius;
          rect.position.y = Math.sin(angle) * radius;
          rect.position.z = -50 + j * 25;

          rect.lookAt(0, 0, rect.position.z);

          group.add(rect);
        }

        rectangleGroups3.push(group);
        scene3.add(group);
      }

      animate3();
    }

    function animate3() {
      requestAnimationFrame(animate3);
      time3 += 1;

      if (scene3 && scene3.children[0]) {
        scene3.children[0].material.uniforms.time.value = time3;
      }

      rectangleGroups3.forEach((group, j) => {
        group.rotation.y += 0.01;
        group.rotation.x += 0.005;

        group.children.forEach((mesh, i) => {
          const hue = (i * 2 + time3 * 0.5 + j * 30) % 360;
          const color = new THREE.Color();
          color.setHSL(hue / 360, 1, 0.6);
          mesh.material.color.set(color);
        });
      });

      if (renderer3 && scene3 && camera3) {
        renderer3.render(scene3, camera3);
      }
    }

    // Initialize when Three.js content is shown
    function initThreeJSContent() {
      const threeJSContent = document.getElementById('threejs-content');
      if (threeJSContent && threeJSContent.style.display !== 'none') {
        setTimeout(() => {
          initThreeJS1();
          initThreeJS2();
          initThreeJS3();
        }, 100);
      }
    }

    // Watch for content changes
    const threeJSObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'threejs-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initThreeJS1();
              initThreeJS2();
              initThreeJS3();
            }, 100);
          }
        }
      });
    });

    if (document.getElementById('threejs-content')) {
      threeJSObserver.observe(document.getElementById('threejs-content'), { attributes: true });
    }
  </script>

  <!-- Mapbox Maps -->
  <script>
    let map = null;
    let advancedMap = null;
    let routineMap = null;

    function initMapbox() {
      const mapContainer = document.getElementById('map');
      if (!mapContainer) return;

      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v12',
        center: [-74.006, 40.7128],
        zoom: 12,
        pitch: 45,
        bearing: 0
      });

      map.addControl(new mapboxgl.NavigationControl(), 'top-right');
      map.addControl(new mapboxgl.FullscreenControl(), 'top-right');

      map.on('load', function() {
        const columbiaMarker = new mapboxgl.Marker({ color: '#007bff' })
          .setLngLat([-73.9626, 40.8075])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Columbia University</h3><p>Home of the Computational Design Program</p>'))
          .addTo(map);

        const timesSquareMarker = new mapboxgl.Marker({ color: '#ff6b6b' })
          .setLngLat([-73.9855, 40.7580])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Times Square</h3><p>Iconic NYC landmark</p>'))
          .addTo(map);

        const centralParkMarker = new mapboxgl.Marker({ color: '#28a745' })
          .setLngLat([-73.9654, 40.7829])
          .setPopup(new mapboxgl.Popup().setHTML('<h3>Central Park</h3><p>Urban green space</p>'))
          .addTo(map);
      });

      map.on('click', function(e) {
        const coordinates = e.lngLat;
        new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML(`<h4>Coordinates</h4><p>Longitude: ${coordinates.lng.toFixed(4)}</p><p>Latitude: ${coordinates.lat.toFixed(4)}</p>`)
          .addTo(map);
      });

      const neighborhoods = {
        'manhattan': { center: [-73.9654, 40.7829], zoom: 12, name: 'Manhattan' },
        'brooklyn': { center: [-73.9497, 40.6501], zoom: 11, name: 'Brooklyn' },
        'queens': { center: [-73.7949, 40.7282], zoom: 11, name: 'Queens' },
        'times square': { center: [-73.9857, 40.7580], zoom: 15, name: 'Times Square' },
        'central park': { center: [-73.9654, 40.7829], zoom: 14, name: 'Central Park' }
      };

      const searchInput = document.getElementById('neighborhood-search');
      const searchBtn = document.getElementById('search-btn');

      function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        
        if (searchTerm === '') {
          alert('Please enter a neighborhood name to search.');
          return;
        }

        const neighborhood = neighborhoods[searchTerm];
        
        if (neighborhood) {
          map.flyTo({
            center: neighborhood.center,
            zoom: neighborhood.zoom,
            duration: 2000
          });

          new mapboxgl.Popup()
            .setLngLat(neighborhood.center)
            .setHTML(`<h3>${neighborhood.name}</h3><p>Welcome to ${neighborhood.name}!</p>`)
            .addTo(map);
        } else {
          alert('Neighborhood not found. Please try a different search term.');
        }
      }

      searchBtn.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    }

    function initAdvancedMapbox() {
      const mapContainer = document.getElementById('advanced-map');
      if (!mapContainer) return;

      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      advancedMap = new mapboxgl.Map({
        container: 'advanced-map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-73.9654, 40.7829],
        zoom: 13,
        pitch: 0,
        bearing: 0
      });

      advancedMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
      advancedMap.addControl(new mapboxgl.FullscreenControl(), 'top-right');

      const manhattanFeatures = {
        type: 'FeatureCollection',
        features: [
          {
            type: 'Feature',
            id: 'times-square-station',
            properties: {
              name: 'Times Square - 42nd Street',
              type: 'subway-station',
              lines: '1, 2, 3, 7, N, Q, R, W, S',
              description: 'Major subway hub serving multiple lines',
              daily_riders: '200,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9875, 40.7580]
            }
          },
          {
            type: 'Feature',
            id: 'grand-central-station',
            properties: {
              name: 'Grand Central Terminal',
              type: 'subway-station',
              lines: '4, 5, 6, 7, S',
              description: 'Historic train terminal and subway station',
              daily_riders: '750,000+',
              accessibility: 'Yes'
            },
            geometry: {
              type: 'Point',
              coordinates: [-73.9770, 40.7520]
            }
          }
        ]
      };

      advancedMap.on('load', function() {
        advancedMap.addSource('manhattan-features', {
          type: 'geojson',
          data: manhattanFeatures
        });
        
        advancedMap.addLayer({
          id: 'subway-stations',
          type: 'circle',
          source: 'manhattan-features',
          paint: {
            'circle-radius': 12,
            'circle-color': '#F44336',
            'circle-stroke-color': '#D32F2F',
            'circle-stroke-width': 3,
            'circle-opacity': 1.0
          }
        });

        advancedMap.on('mouseenter', 'subway-stations', function(e) {
          if (e.features.length > 0) {
            advancedMap.getCanvas().style.cursor = 'pointer';
            const feature = e.features[0];
            const popup = new mapboxgl.Popup({
              closeButton: false,
              closeOnClick: false
            });
            
            popup.setLngLat(e.lngLat)
              .setHTML(`
                <h3>${feature.properties.name}</h3>
                <p><strong>Type:</strong> ${feature.properties.type}</p>
                <p><strong>Description:</strong> ${feature.properties.description}</p>
                ${feature.properties.lines ? `<p><strong>Subway Lines:</strong> ${feature.properties.lines}</p>` : ''}
                ${feature.properties.daily_riders ? `<p><strong>Daily Riders:</strong> ${feature.properties.daily_riders}</p>` : ''}
                ${feature.properties.accessibility ? `<p><strong>Accessibility:</strong> ${feature.properties.accessibility}</p>` : ''}
              `)
              .addTo(advancedMap);
            
            feature.popup = popup;
          }
        });

        advancedMap.on('mouseleave', 'subway-stations', function(e) {
          advancedMap.getCanvas().style.cursor = '';
          if (e.features.length > 0 && e.features[0].popup) {
            e.features[0].popup.remove();
          }
        });
      });

      document.getElementById('reset-view').addEventListener('click', function() {
        advancedMap.flyTo({
          center: [-73.9654, 40.7829],
          zoom: 13,
          pitch: 0,
          bearing: 0,
          duration: 2000
        });
      });
    }

    function initRoutineMapbox() {
      const mapContainer = document.getElementById('routine-map');
      if (!mapContainer) return;

      mapboxgl.accessToken = 'pk.eyJ1IjoiamlpbmthbmdnIiwiYSI6ImNtYXV1MDh1aDAwdnoya3B5NnFlcWh5NmYifQ.ZXjsL-aQyFYxyG5p5XI_lA';

      routineMap = new mapboxgl.Map({
        container: 'routine-map',
        style: 'mapbox://styles/mapbox/light-v11',
        center: [-73.9710, 40.7880],
        zoom: 13,
        pitch: 0,
        bearing: 0
      });

      routineMap.addControl(new mapboxgl.NavigationControl(), 'top-right');
      routineMap.addControl(new mapboxgl.FullscreenControl(), 'top-right');

      routineMap.on('load', function() {
        fetch('my_routine.geojson')
          .then(response => response.json())
          .then(data => {
            routineMap.addSource('routine-data', {
              type: 'geojson',
              data: data
            });
            
            routineMap.addLayer({
              id: 'route-line',
              type: 'line',
              source: 'routine-data',
              filter: ['==', ['geometry-type'], 'LineString'],
              paint: {
                'line-color': '#FF6B6B',
                'line-width': 4,
                'line-opacity': 0.8
              }
            });
            
            routineMap.addLayer({
              id: 'routine-points',
              type: 'circle',
              source: 'routine-data',
              filter: ['==', ['geometry-type'], 'Point'],
              paint: {
                'circle-radius': 10,
                'circle-color': '#4ECDC4',
                'circle-stroke-color': '#2C3E50',
                'circle-stroke-width': 2,
                'circle-opacity': 0.8
              }
            });
            
            const bounds = new mapboxgl.LngLatBounds();
            data.features.forEach(feature => {
              if (feature.geometry.type === 'Point') {
                bounds.extend(feature.geometry.coordinates);
              } else if (feature.geometry.type === 'LineString') {
                feature.geometry.coordinates.forEach(coord => {
                  bounds.extend(coord);
                });
              }
            });
            
            routineMap.fitBounds(bounds, {
              padding: 50,
              duration: 2000
            });
          })
          .catch(error => {
            console.error('Error loading routine data:', error);
          });
      });
    }

    // Initialize maps when mapping content is shown
    function initMappingContent() {
      const mappingContent = document.getElementById('mapping-content');
      if (mappingContent && mappingContent.style.display !== 'none') {
        setTimeout(() => {
          initMapbox();
          initAdvancedMapbox();
          initRoutineMapbox();
        }, 100);
      }
    }

    const mapObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (mutation.target.id === 'mapping-content' && mutation.target.style.display !== 'none') {
            setTimeout(() => {
              initMapbox();
              initAdvancedMapbox();
              initRoutineMapbox();
            }, 100);
          }
        }
      });
    });

    if (document.getElementById('mapping-content')) {
      mapObserver.observe(document.getElementById('mapping-content'), { attributes: true });
    }
  </script>
</body>
</html> 